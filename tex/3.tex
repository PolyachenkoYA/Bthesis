\chapter{Результаты моделирования}
\label{Sec:Results}

В этой главе приведены результаты и анализ расчётов.

В разделе \ref{Subsec:KdirectMethodsVer} предложенные выше методы расчета $K$ проверяются на работоспособность на простой системе чистой воды.

Далее в разделе \ref{Subsec:BarostatTermostat} обсуждается теория баро- и термо-статирования, результаты применения которых затем проверяются на сходимость в разделе \ref{Subsec:KconvBaroTermo}.

Значения $K$ расчитаны в разделе \ref{Subsec:Kcomp}. Обсуждаются возможные причины разхождения с эксмерипентом. В разделе \ref{Subsec:ResWater2phase} делается попытка исправить одну из возможных причин расхождения -- неверный процесс релаксации системы перед расчетами -- при помощи проведения 2-фазного моделирования для нахождения равновестных параметров системы.

\section{Верификация прямых методов расчета $K$}
\label{Subsec:KdirectMethodsVer}

Преждем чем применять методы \eqref{eq:2:K_dV_def} и \eqref{eq:2:K_fluct_def} для <<сложной>> системы воды+белок, надо проверить их на более простом примере. Например для воды хорошо известно экспериментальное значение $K$. К тому же, вода будет участвовать и в целевом расчете, поэтому проверить ее адекватное воспроизведение хотя бы в чистом виде все равно необходимо. Тут, как и далее, используется модель воды tip4p/2005 \citep{Abascal2005}. Выбор в пользу более сложной модели воды вместо часто используемых в симуляциях белков SPC/E \citep{Berendsen1981, Berweger1995, Berendsen1987} и tip3p \citep{Jorgensen1983, Neria1996} сделан потому, что эффект роста $K$ при уменьшении температуры наблюдается на мастшабах $\sim 10 K$, в то время как даже такие менее тонкие эффеекты как например температура кристализации воды занижается моделью SPC/E на $\sim 50K$. 

На Рис. \ref{img:3:water_test_2methods} приведено сравнение экспериментального $K$ с рассчитанными по \eqref{eq:2:K_dV_def} и \eqref{eq:2:K_fluct_def}. Флюктуационный метод совпадает с экспериментом в пределах погрешности, но эта погрешность достаточно велика $\sim 10\%$. Метод малых смещений дает меньшую погрешность, и дает отклонение от эксперимента на $\sim 5\%$. 

\begin{figure}[h!]
  \center{\includegraphics[scale=0.5]{water_test_2methods}}
  \caption{Сравнение $K$, полученных двумя прямыми методами \eqref{eq:2:K_dV_def} и \eqref{eq:2:K_fluct_def}, с экспериментальными значениями. $t_{stab}$ -- время в начале моделирования, отбрасываемое при анализе. Как видно, система из чистой воды выходит на равновесие уже после 0.25 нс. эволюции.}
  \label{img:3:water_test_2methods}
\end{figure}

\section{Используемые баростат и термостат}
\label{Subsec:BarostatTermostat}

Численное решение неизмененных уравнений Ньютона приводит к симуляции $NVE$ ансамбля, однако часто бывает интересно поведение системы в других условиях, таких как $NVT$ и $NPT$. Их вспроизведения в расчете не так тривиально. Например, существуют достаточно идейно-простые методы термостатирования системы, такие как термостат Берендсена. Физически он заключается в насильном выполнении

\begin{equation} \label{eq:3:Berendsen_diff_form}
\dfrac{dT}{dt} = \dfrac{T_0 - T}{\tau},
\end{equation}

где $T$ -- текущая температура системы, $T_0$ -- целевая температура, $t$ -- время, $\tau$ -- характерное время релаксации системы к целевой температуре.

При дискретизации \eqref{eq:3:Berendsen_diff_form} апроксимируется \citep{Berendsen1991} масштабированием скоростей частиц на фактор 

\begin{equation}
\lambda = \sqrt{ 1 + \left( \dfrac{T_0}{T} - 1 \right) \dfrac{\Delta t}{\tau_T} }, \hspace{10pt} \tau_T = \tau \dfrac{3 N_{df} k_B / 2}{C_V},
\end{equation}

где $C_V$ -- теплоемкость системы при постоянном объеме, $N_{df}$ -- количество степеней свободы в системе.

Проблема таких <<наивных>> подходов заключается в том, что они как правило искажают распределение частиц в фазовом пространстве таким образом, что средние значения термодинамических величин не затрагиваются, но флюктуации и тем более высшие моменты начинают расходится с естественным поведением моделируемых ансамблей. В случае термостатирования эта проблема решается термостатом Нозе-Гувера \citep{Nos1984, Hoover1985}. Его идея состоит в модификации уравнений движения путем введения дополнительной степени свободы $s$ <<резервуара>>, с которым связана динамика всех реальных частиц системы:

\begin{equation} \label{eq:3:NoseHooverIdea}
\begin{aligned}
& \frac{\mathrm{d}^{2} \boldsymbol{r}_{i}}{\mathrm{~d} t^{2}}=\frac{\boldsymbol{F}_{i}}{m_{i}}-\frac{p_{s}}{Q} \frac{\mathrm{d} \boldsymbol{r}_{i}}{\mathrm{~d} t} \\
& \frac{\mathrm{d} p_{s}}{\mathrm{d} t}= \dfrac{N_{df} k_B (T-T_{0})}{Q} \\
\end{aligned}.
\end{equation}

Как видно, при $T > T_0$ коэффициент трения положителен и энергия диссипирует, поэтому $T$ уменьшается. При $T < T_0$ же наоборот происходит разгон частиц т.к. <<трение>> отрицательно. Это порождает затухающие осциляции температуры около целевого значения. Характерный период осцилляций

\begin{equation}
\tau_T \sim 2 \pi \sqrt{\dfrac{Q}{2 N_{df} k_B T}}
\end{equation}

Уравнения \eqref{eq:3:NoseHooverIdea} не гамильтоновы, но можно показать \citep{Nos1984}, что гамильтониан

\begin{equation} \label{eq:3:NoseHooverHfull}
\begin{aligned}
& \mathcal{H}_0(\mathbf{p}, \mathbf{r}) = \sum_{i=1}^{N} \frac{\boldsymbol{p}_{i}^2}{2 m_{i}}+U\left(\boldsymbol{r}_{1}, \boldsymbol{r}_{2}, \ldots, \boldsymbol{r}_{N}\right) \\
& \mathcal{H}(\mathbf{p}, \mathbf{r}, p_s, s)=\mathcal{H}_0\left(\dfrac{\mathbf{p}}{s}, \mathbf{r}\right)+\frac{p_{s}^{2}}{2 Q}+N_{df} k_B T \ln(s) \\
\end{aligned}
\end{equation}

приводит к системе, аналогичной \eqref{eq:3:NoseHooverIdea} в переменных $(q, p / s)$. 

Наличие гамильновой формулировки позволяет применить формализм расложения Троттера для оператора эволюции системы, что в свою очередь позволяет без затруднений выписывать численные схемы, аналогичные схемам Verlet, для сложных ансамблей \citep{Martyna1996}.

При этом симуляция \eqref{eq:3:NoseHooverHfull} в $NVE$ (точнее $NV\mathcal{H}$) ансамбле будет соответствовать симуляции невозмущенной системы $\mathcal{H}_0$ в $NVT$. Это происходит потому, что $NV\mathcal{H}$-статсумма системы

\begin{equation}
Z_{N-H}=\frac{1}{N !} \int d p_{s} \int d s \int d \mathbf{p} \int d \mathbf{r} \hspace{3pt} \delta\left[\mathcal{H}(\mathbf{p}, \mathbf{r}, p_s, s)-E\right]
\end{equation}

представляется \citep{Nos1984} как

\begin{equation}
\begin{aligned}
& Z_{N-H}=\frac{1}{N_{df}+1}\left(\frac{2 \pi Q}{k T_{0}}\right)^{1 / 2} \exp \left( \dfrac{E}{k_B T_{0}}\right) Z_{NVT}\left(\dfrac{\mathbf{p}}{s} , \mathbf{r}\right) \\
& Z_{NVT}\left(\mathbf{p} , \mathbf{r}\right)=\frac{1}{N !} \int d \mathbf{p} \int d \mathbf{r} \exp \left[- \dfrac{\mathcal{H}_0\left(\mathbf{p}, \mathbf{r}\right)}{k_B T_{0}}  \right] \\
\end{aligned},
\end{equation}

что при усреднении любой термодинамической величины, зависящей от $\left(\mathbf{p}/s, \mathbf{r}\right)$, эффективно приведет к усреднению лишь по $Z_{NVT}\left(\mathbf{p}/s, \mathbf{r}\right)$, что как раз эквивалентно симуляции $NVT$ ансамбля. Выражаясь более строго,

\begin{equation}
\left\langle A\left(\frac{\mathbf{p}}{s}, \mathbf{r}\right)\right\rangle_{N-H}=\left\langle A\left(\mathbf{p}, \mathbf{r}\right)\right\rangle_{NVT}
\end{equation}

Следует уточнить, что реально используемая схема принципиально следует изложенной идее, но не точно ее повторяет. Дело в том, что уравнения \eqref{eq:3:NoseHooverIdea} могут быть не эргодичны, и есть примеры, когда это действительно так \citep{Cooke2008}. Для решения этой проблемы предложено использовать цепи Нозе-Гувера \citep{Martyna1992}. Добавление даже нескольких звеньев уже существенно улучшает эргодичность, хотя и не делает ее математически точной. Доказано, что при стремлении количества цепей к бесконечности динамика системы будет эргодичной. В расчетах используется цепь из 10 звеньев, как достаточная для подавляющего большинсва расчетов. Внимательно рассматривать значения этого параметра может быть разумно при проведении термодинамического интегрирования, чего в нашем случае не происходит, поэтому используется стандартное значение. 

Для приложения внешних напряжений так же существуют как более интуитивные методы, которые однако не воспроизводят динамику системы со всей полнотой, так и более сложные методы, которые доказано моделируют $NPT$ ансамбль.

Например есть аналог термостата Берендсена \citep{Berendsen1984}, реализующий теперь идею 

\begin{equation}
\frac{\mathrm{d} \hat{P}}{\mathrm{d} t}=\frac{\hat{P}_{0}-\hat{P}}{\tau_{p}},
\end{equation}

которая при дискретизации реализуется масштабированием ячейки и координат всех атомов в ней с помощью матрицы

\begin{equation}
\mu_{i j}=\delta_{i j}-\frac{\Delta t}{3 \tau_{p}} \beta_{i j}\left\{P_{0 i j}-P_{i j}(t)\right\},
\end{equation}

где $\beta_{ij}$ -- тензор изотермической сжимаемости, определяемый как \citep{Parrinello1981}

\begin{equation} \label{eq:3:beta_def}
\beta_{ij} \Delta P = \varepsilon_{ij} = \dfrac{1}{2} \left[ (\hat{h} \hat{h}_0^{-1})^T \hat{h} \hat{h}_0^{-1} - 1 \right],
\end{equation}

где $\hat{h} = \{\mathbf{a},\mathbf{b},\mathbf{c}\}$ -- матрица, составленная из базисных векторов периодической расчетной ячейки, $\hat{h}_0$ -- равновесное положение ячейки.

Качественно понять определение \eqref{eq:3:beta_def} можно так. Если $\hat{h}$ и $\hat{h}_0$ диагональны, то можно перейти к рассмотрению деформации по одной произвольно выбранной оси, а по остальным рассуждения будут аналогичны. При проекции на 1 ось диагональные $\hat{h}$ и $\hat{h}_0$ переходят в $L = L_0 + \Delta L$ и $L_0$ соответственно, что дает при выборе например оси $X$:

\begin{equation}
\beta_{xx} \Delta P = \dfrac{1}{2} \left[ \left( \dfrac{L_0 + \Delta L}{L_0} \right)^2 - 1 \right] \approx \dfrac{\Delta L}{L_0} \Rightarrow \beta_{xx} = \dfrac{1}{L_0} \dfrac{\Delta L}{\Delta P} \sim \left. \left( \dfrac{1}{L} \dfrac{\partial L}{\partial P} \right) \right|_{L = L_0}
\end{equation}

Как и в случае в термостатом Берендсена, данный алгоритм относительно прост, однако воспроизводимая им динамика вообще говоря отличается от естественной, хотя и не изменяет средние значения термодинамических величин.

Парринело и Рахман \citep{Parrinello1981} предложили подход, аналогичный подходу Нозе-Гувера. Уравнения движения системы модифицируются как

\begin{equation}
\begin{aligned}
& \frac{\mathrm{d}^{2} \boldsymbol{r}_{i}}{\mathrm{~d} t^{2}}=\frac{\boldsymbol{F}_{i}}{m_{i}}-\left[ \hat{h}^{-1} \dfrac{\mathrm{d} \hat{h}}{\mathrm{d} t} + \left( \hat{h}^{-1} \dfrac{\mathrm{d} \hat{h}}{\mathrm{d}t} \right)^{T} \right] \frac{\mathrm{d} \boldsymbol{r}_{i}}{\mathrm{~d} t} \\
& \frac{\mathrm{d} \hat{h}^{2}}{\mathrm{~d} t^{2}}=V \hat{W}^{-1} (\hat{h}^T)^{-1}\left(\hat{P}-\hat{P}_{0}\right) \\
\end{aligned},
\end{equation}

где $V$ -- объем системы, $\hat{W}$-- параметр силы баростата, аналог массы для степеней свободы размеров периодической ячейки.

Эти уравнения сохраняют гамильтониан

\begin{equation} \label{eq:3:PR_hamiltonian}
\mathcal{H}_{P-R} = \sum \dfrac{m_i \mathbf{v}_i^2}{2} + U(\mathbf{r}_1, \ldots \mathbf{r}_N) + \dfrac{Tr(\dot{\hat{h}}^T \hat{W} \dot{\hat{h}})}{2} + \dfrac{Tr(\hat{P})}{3} \det(\hat{h}),
\end{equation}

где $\mathbf{v}_i$ учитывает только движение частицы внутри ячейки, но не изменение самой ячейки. Т.е. если представить $\mathbf{r} = \hat{h} \mathbf{s}$, то $\mathbf{v} = \hat{h} \dot{\mathbf{s}}$, но не $\hat{h} \dot{\mathbf{s}} + \dot{\hat{h}} \mathbf{s}$.

Гамильтониан \eqref{eq:3:PR_hamiltonian} равен энтальпии системы $H$ с точностью $\sim 1/N$, что как раз приводит $NP\mathcal{H}_{P-R}$ ансамбль к $NPH$ ансамблю.

Параметр $\hat{W}$ не очень интуитивен, поэтому полезно указать его связь с более явными величинами:

\begin{equation}
\left(\hat{W}^{-1}\right)_{i j}=\frac{4 \pi^{2} \beta_{i j}}{3 \tau_{p}^{2} \max(\{L_k\})},
\end{equation}

где $L_k$ -- размеры ячейки.

\section{Сходимость $K$ по параметрам термостата и баростата}
\label{Subsec:KconvBaroTermo}

Как упоминалось выше, расчет термодинамических величин, таких как $K$, при активном термо- или баро-статировании может сказаться на полечаемых результатах. Поэтому прежде чем проводить вычислительные измерения $K$, нам нужно найти такие параметры термостата и баростата $\tau_T$, $\tau_P$ (являющиеся параметрами, отсутствующими в реальности), чтобы получаемые значения $K$ уже не зависили от них. Также должа быть достигнута сходимость $K$ по времени усреднения.

Такой анализ был проведен, и его результаты приведены на Рис. \ref{img:3:tau_conv}:

\begin{figure}[h!]
\subfloat{\includegraphics[scale=0.6]{tau_conv_t20}}
\subfloat{\includegraphics[scale=0.6]{tau_conv_t40}}
\caption{Проверка сходимости $K$ по силе баростата и термостата для флюктуационного метода расчета \eqref{eq:2:K_fluct_def}. Для уменьшения количества пробных расчетов одновременно менялись силы баростата и термостата, что отражено как $\tau_T = \tau_P/4$. Погрешности точек размеров с символы точек. Синие точки - анализ расчетных данных, проведенный в данной работе. Красные точки - значения, автоматически расчитываемые Громаксом. Отличие обсуждается ниже.}
\label{img:3:tau_conv}
\end{figure}

Видно, что времени усреднения 20 нс. не хватает чтобы получать стабильные $K$ при любой силе внешнего создействия. Времени же в 40 нс. уже достаточно. На том же графике для 40 нс. видна граница силы воздействия, после которой зависимость от силы термостата пропадает. Но делать теостат слишком слабым тоже не оптимально, т.к. это скажется на скорости уменьшения погрешностей точек, что приведет к необходимости заметно увеличивать время симуляции. В итоге было выбрано значение $\tau_P = 128$ нс. и соответствующее значение $\tau_T$.

На Рис. \ref{img:3:tau_conv} так же присутствуют красные точки, отвечающие значением $K$, автоматически вычисленным пакетом GROMACS \citep{Abraham2015}. В нем используется так же формула \eqref{eq:2:K_fluct_def}, но отличие состоит в том, что Громакс не учитывает начилие начального этапа релаксации. Причина наглядно пояснена на Рис. \ref{img:3:Vt_gromacsVSme}.

\begin{figure}[h!]
  \center{\includegraphics[scale=0.5]{Vt_gromacsVSme}}
  \caption{Сравнение реализаций расчета $K$ по \eqref{eq:2:K_fluct_def}, использовыннах в данной работе и автоматически проводимых Громаксом. Громакс использует для расчета $\langle \Delta V^2 \rangle$ вся траекторию, не учитывая начальный этап релаксации. Это приводит к завышению $\langle \Delta V^2 \rangle$, что наглядно видно на рисунке -- во время релаксации колебания объема значительно больше чем в расновестном состоянии. И чем слабее баростат, тем дольше занимает этап релаксации, и соответственно тем больше завышается значение $\langle \Delta V^2 \rangle$, что все больше занижает значения $K$. Этот эффект явно виден на Рис.  \eqref{img:3:tau_conv}}
  \label{img:3:Vt_gromacsVSme}
\end{figure}

Для метода малых смещений \eqref{eq:2:K_dV_def} нужно провести аналогичную проверку по сходимости параметров метода. В данном случае это малость изменения объема и сила термостата, выражаемая $\tau_T$. Результаты тестов представлены на Рис. \ref{img:3:dV_conv}

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{dV_conv}}
  \caption{Проверка сходимости метода расчета $K$ малыми смещениями \eqref{eq:2:K_dV_def} по малости изменения объема и по силе термостата. Для согласованности было использовано время усреднения 40 нс., т.к. выше было найдено, что это время оптимально для расчетов по флюктуационному методу. Видно, что в области $\tau_T > 32$ нс., $dV/V > 10^{-2.5}$ значения $K$ стабильны в пределах погрешности. }
  \label{img:3:dV_conv}
\end{figure}

Для флюктуационного метода выше было выбрано $\tau_T = 32$ нс., поэтому здесь для согласованности мы взяли то же значение, т.к. оно входит в область плато, указанную на Рис. \ref{img:3:dV_conv}. Значение $dV$ было выбрано минимально возможным еще входящим в плато из соображений наименьшего искуственного возмущения системы. Можно было бы пытаться увеличивать время усреднения, и таким образом получать плато на еще меньших значениях $dV$, т.к. ошибка возникает из-за того что при малых $dV$ ожидаемое изменение $dP$ также мало, поэтому хуже регистрируется при малом усреднении. Но чтобы уменьшить допустимое $dV$ на пол порядка, нужно увеличить время усреднения в 10 раз. Поэтому было решено оставить время усреднения и выбрать $dV$ достаточно большое, чтобы этого времени хватало для различения $dP$, т.е. в данном случае $dV/V = 10^{-2.5}$.

\section{Расчет $K$ прямыми методами}
\label{Subsec:Kcomp}

Получив сходимость по нефизичным параметрам методов, мы можем наконец применить их для расчета $K$ белка при различных температурах. Используются ранее выбранные параметры методов:

\begin{itemize}
\item NVT: $dV/V \sim 10^{-2.5}$, $\tau_T = 32$ нс., $t_{avg} = 40$ нс.
\item NPT: $\tau_P = 128$ нс., $\tau_T = 32$ нс., $t_{avg} = 40$ нс.
\end{itemize}

Так же используется метод определения количества воды в системе, описанный в разделе \ref{Subsec:CalculationConverge}, основанный на подборе количества воды для достижения экспериментального давления.

Результаты расчетов представлены на Рис. \ref{img:3:K_T_0}:

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{K_T_0_lin}}
  \caption{Результаты расчета $K$ прямыми методами \eqref{eq:2:K_dV_def} и \eqref{eq:2:K_fluct_def} при гидратации, описанной в разделе \ref{Subsec:CalculationConverge}. Методы дают согласованные значения, что говорит в пользу корректности полученных результатов.}
  \label{img:3:K_T_0_lin}
\end{figure}

Из-за самосогласованности результатов, полученных двумя независимыми методами, можно говорить о физичности расчитываемого $K$. Однако, полученные значения заметно отличаются от экспериментальных, что демонстрируется на Рис. \ref{img:3:K_T_0_with_exp}:

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{K_T_0_with_exp}}
  \caption{Сравнение значений $K$, расчитанных двумя методами, с экспериментальными значениями. Кресты (exp 1) -- работа \citep{Wang2011}, Круги (exp 2) -- \citep{Gorelov1987}. Возможные причины расхождения обсуждаются далее.}
  \label{img:3:K_T_0_with_exp}
\end{figure}

У данного расхождения может быть множество причин, и их исследование составляет нижеизложенную часть представленной работы и имеет перспективу для дальнейшего развития.

Одной из возможных причин может быть то, что используемая параметризация белка не воспроизводит именно $K$. В расчетах использовалась параметризация amber03 \citep{Duan2003} с моделью воды tip4p/2005 \citep{Abascal2005}. Как упоминалось в разделе \ref{Subsec:KdirectMethodsVer}, вода предположительно \citep{Wang2011} играет важную роль в эффекте излома зависимости $K(T)$, в то время как стандартные модели воды SCP/E и tip3p воспроизводят даже такой параметр как температуру кристализации с недопустимой в данном случае ошибкой. Поэтому было решено использовать воду tip4p, которая воспроизводит по крайне мере фазовую диаграмму с приемлимой в данном случае точностью. Выбор данной модели воды же повлек использование параметризации amber03, т.к. именно она проверенно согласованна с водой tip4p/2005. 

Параметры потенциала amber03 были получены из квантовомеханических расчетов. Верификация же проводилась сравнением карт Рамачандрана углов полипептидной связи. Авторам не известно о тестах потенциала amber03, подтверждающих воспроизведение им упругих свойств Лизоцима, поэтому это может не иметь места с достаточной точностью. Можно привести кафественные рассуждения, почему воспроизведение карт Рамачандрана не обязано свидетельствовать об ожидаемых упругих свойствах кристалла. Дело в том, что карты Рамачандрана характеризуют равновесное состояние белка, т.е. распределение средних значений углов полипептидной связи. Упругие же свойсва при малых деформациях будут зависеть не от равновесных значений углов, а от резкости потенциальных ям, в которых находятся эти средние значения. Об этом говорит возможность расчета $K$ из флюктуаций объема, т.е. из динамической характеристики. А поэтому карты рамачандрана зависят не совсем от тех же сочетаний параметров потенциала, от которых зависит $K$, что значит, что их воспроизведение не так жеско связано с воспроизведением $K$. Стоит однако заметить, что заметная корреляция должна быть, поскольку большое количество совпавших с экспериментом точек на карте рамачандрана накладывает много ограничений на возможные значения параметров потенциала.

Другой возможной причиной мы считаем неверную работу с водой в системе. Дело в том, что в эксперименте порошок лизоцима находился в равновесии с водяными парами. Поэтому если мы воспроизведем контакт сред пар-белок в расчете, то система сама может прийти к правильному количеству воды в белке, вытеснив лишнюю воду в соответствующий объем изначально пустого пространства.

\section{Анализ мобильности воды}
\label{Subsec:Wmob}

Интересным исследованием, проведенным в процессе работы, было изучение мобильности молекул воды внутри кристалла белка. Данный вопрос может быть актуален в контексте расчета $K$, т.к. наличие болшого количества жеско связанной с белком воды может сильно влиять на жесткость всей системы в целом. Поэтому возникает задача класификации молекул воды на <<мобильные>> с <<связанные>>. Подобная класификация можеть быть полезна еще и тем, что позволит проследить динамику распределения молекул воды по мобильности. Из физических соображения ясно, что в системе, вышедшей на равновесие, подобное распределение не должно изменяться со временем, хотя конкретные молекулы конечно будут могут менять свою мобильность в процессе эволюции.

\subsection{Максимальное смещение}
\label{Subsubsec:rmax}

Для построения распределения воды по мобильности нужно определить, что именно мы называем мобильностью молекулы. Простейшим вариантом является максимальное смещение на время симуляции, т.е. $m_i = \max_t((\mathbf{r}_i(t) - \mathbf{r}_i(0))^2) = \max_t(\Delta r_i(t)^2)$. Типичное распределение по данной характеристистике приведено на Рис. \ref{img:3:r2_dist}:

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{r2_dist}}
  \caption{Распределение молекул воды по максимальному за время симуляции смещению.}
  \label{img:3:r2_dist}
\end{figure}

Видно, что распределение на Рис. \ref{img:3:r2_dist} представляет собой один главный пик и небольшое количество сильно связанных молекул. Эта небольшая группа сильно отличается по свойствам от остальной воды и будет лекго обнаружима на всех дальнейших методах анализа. Основная же группа имеет куполообразную форму с единственным пиком, поэтому плохо класифицируется. Дело в том, что качественно зависимости $\Delta r(t)^2$ делятся на 2 типа (Рис. \ref{img:3:r1_displ}):

\begin{figure}[h!]
\subfloat{\includegraphics[scale=0.6]{r1_stable}}
\subfloat{\includegraphics[scale=0.6]{r1_nonstable}}
\caption{Типичные виды зависимостей $\sqrt{\Delta r(t)^2}$.}
\label{img:3:r1_displ}
\end{figure}

Как видно на Рис. \ref{img:3:r1_displ}, есть молекулы, просто почти свободно движущиеся в системе (рисунок слева), а есть такие, которые часть времени находятся в практически связанном состоянии (плато на графике), а в другие моменты времени быстро перемещаются. Оба режима перемещения могут давать схожое максимальное смещение, однако из физических соображений ясно, что класифицировать молекулы из этих 2 групп как похожие -- не очень корректно.

\subsection{Коеффициент диффузии}

Следующим испытанным вариантом метрики мобильности было значение коэффециента диффузии молекулы $D$, т.е. фактически наклон графика $\Delta r^2(t)$.

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{D_dist_0interscept}}
  \caption{Распределение молекул воды по их коэффициенту диффузии}
  \label{img:3:D_dist_0interscept}
\end{figure}

Проблема $D$ как метрики мобильности опять же заключается в наличии единственного пика, что видно на Рис. \ref{img:3:D_dist_0interscept}. Это не позволяет разумно разбить молекулы на 2 группы. Были предприняты также попытки вводить определенный граничный $D_{mob}$, и считать мобильными все молекулы с $D > D_{mob}$. Однако недостаток такого подхода в том, что характерные $D$ в системе сильно зависят от температуры, поэтому для воспроизводимости класификации при различных температурах нужно вводить температную зависимость и в $D_{mob}(T)$. Это можно сделать, измерив или расчитав $D_{pureW}$ в чистой воде при различных $T$, и положив $D_{mob}(T) = \alpha D_{pureW}(T)$, $\alpha < 1$. $D_{mob}(T)$ можно так же получать, анализируя распределения, подобные Рис. \ref{img:3:D_dist_0interscept}, результаты чего представлены на Рис. \ref{img:3:Dcut_T}: 

\newpage

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{Dcut_T}}
  \caption{Результаты расчета $D_{mob}(T)$ по двум критериям. 1 -- отсечение по пороговому значению плотности вероятности. Такой критерий имеет смысл т.к. по Рис. \ref{img:3:D_dist_0interscept} видно, что распределение $D$ молекул воды начинает монотонно спадать практически сразу после 0. Если принять монотонность спадания $p(D)$, то более строго $D_{dens}(T) = \sup(\{D:p(D(T)) > p_0(T)\})$. На рисунке $p_0 = 0.5$ $ns/nm^2$. 2 -- отсечение по кумулятивной вероятности, т.е. взяние за $D_{mob}(T)$ значения $D$ молекулы, обладающей $D$ большим, чем у заданной доли от всех молекул. Более строго $D_{cum}(T) = \sup(\{D: \left(\sum_{i=1}^N D_i < D \right) / N < P_{cum}\})$. На рисунке $P_{cum} = 0.9$.}
  \label{img:3:Dcut_T}
\end{figure}

Анализируя два предложенных метода нахождения $D_{mob}(T)$, можно заметить, что в методе отсечения по пороговой плотности вероятности пороговый параметр имеет размерность. Это приводит к тому, что для получения физически-эквивалентных значений $D_{mob}(T)$ необходимо будет изменять значение пороговой плотности вероятности $p_0(T)$. Данная особенность уменьшает ценность данного метода, т.к. цель в данном случае была в формализации и унификации процесса нахождения $D_{mob}(T)$ путем исключения человеческого фактора из алгоритма, в то время как выбор $p_0(T)$ должен делать человек изходя не из четко сформулированных критериев, а из здравого смысла и вида профиля $p(D)$. 

Метод же, основанный на пороговой кумулятивной вероятности, имеет берзазмерный пороговый параметр, что явялется преимуществом. Пользуясть этим методом, можно получить <<степень свободности>> воды в белке в зависимости от температуры. Разумной мерой <<свободности>> может являться отношение $D_{mob} / D_{bulk} < 1$. Чем ближе оно к 1, тем свободнее вода. На рисунке Рис. \ref{img:3:Dprot_vs_Dbulk} представлена зависимости <<свободности>> от температуры:

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{Dprot_vs_Dbulk}}
  \caption{Сравнение средней мобильности воды в системе с белком и в чистом виде. Для нахождения $D_{mob}$ были использованы 2 описанных выше метода с $p_0 = 0.5$ ($nm^2/ns$) и  $P_{cum} = 0.9$.}
  \label{img:3:Dprot_vs_Dbulk}
\end{figure}

Значения, основанные на $p_0$, падают с ростом $T$. Это ожидаемо, т.к. отсечка происходит по плотности вероятности, которая должна удовлетворять условию нормировки $\int_0^{D_{bulk}} p(D) dD = 1$. Это условие приводит к тому, что движение точки $D_{dens}(T) = \sup(\{D:p(D(T)) > p_0(T)\})$ вправо (т.е. рост $D_{dens}$) происходит медленнее чем рост $D_{bulk}$. Рост же $D_{cum} / D_{bulk}$ говорит о том, что с ростом $T$ вода приближается к свободному состоянию, что опять же физично и ожидаемо.

Анализ динамики распределения $p(D, t)$ также позволяет провести дополниткльную верификацию того, что система действительно вышла на равновесие. 

\begin{figure}[h!]
  \center{\includegraphics[scale=0.6]{D_evol}}
  \caption{Динамика распределения молекул воды по их коеффициенту диффузии. Видно, что распределение пришло в равновесие.}
  \label{img:3:D_evol}
\end{figure}


На Рис.  видно, что распределение не изменяется со временем, поэтому можно считать это аргументом в пользу стабильности системы.

\subsection{Корреляция смещения молекулы со временем движения}

Чтобы решить проблему размерности, присутствующую при анализе мобильности через $D$, было предложено обезразмерить измеряемый наклон $r^2(t)$, т.е. перейти от $D \sim \Delta r^2 / \Delta t$ к коеффициенту корреляции между смещение и временем этого смещения $R(r^2(t), t)$. Это изначально безразмерная величина, поэтому любые отчески по ней так же не будут содержать размерных эффектов, таких как рост $D_{bulk}$ с температурой. Для идеальной диффузии должно выполняться $R \approx 1$, или точнее $0 < 1 - R \ll 1$. Типичное распределение молекул воды по $R$ представлено на Рис. \ref{img:3:R_dist}:

\begin{figure}[h!]
  \center{\includegraphics[scale=0.65]{R_dist}}
  \caption{Распределение молекул воды по их корреляции Пирсона $R(r^2(t), t)$. Красным пунктиром отмечено то где человеческий глаз находит изменение характера зависимости распределения.}
  \label{img:3:R_dist}
\end{figure}

Возможное наличие точки качественного изменения характера распределения при критическом $R_0$, отмеченном на Рис. \ref{img:3:R_dist} красным пунктиром, дает надежду, что это $R_0$ может быть использовано для класификации молекул, не зависящей от размерных эффектов. Это может быть сделано, однако использование $R$ как единственной характеристики, отражающей мобильность молекулы, не совсем корректно. Дело в том, что использование $R$ хотя и улучшает ситуацию с проблемой монотонности движения, описанной в \ref{Subsubsec:rmax}, однако не решает ее в достаточной мере, что продемонстрировано на примерах на Рис. \ref{img:3:R_cases}:

\begin{figure}[h!]
\subfloat{\includegraphics[scale=0.45]{Rcase_free}}
\subfloat{\includegraphics[scale=0.45]{Rcase_conf}}
\caption{Примеры зависимостей $\sqrt{\Delta r(t)^2}$, демонстрирующие некорректность использования $R(r^2(t), t)$ как единственного критерия мобильности. }
\label{img:3:R_cases}
\end{figure}
  
На Рис. \ref{img:3:R_cases} видно, что динамика частиц явно отличается. На графике слева молекула движется относительно равномерно, в то время как справа молекула совершает явные перескоки из одной потенциальной ямы в другую. Однако несмотря на явно различный характер движения данных молекул, они обладают очень близкими $R(r^2(t), t)$. Для решения этой проблемы было предложено перейти к одновременному учету 2 характеристик зависимости $r^2(t)$, одна из которых будет характеризовать активность смещения молекулы, а другая -- равномерность движения.

\subsection{Энтропия $r^2(t)$ как мера равномерности}

В качестве меры равномерности смещения было предложено использовать энтропию распределения точек $\{r^2(t_i)\}$, определяемую как 

\begin{equation} \label{eq:3:S_disc_def}
S_{d} = - \sum_{i} P_i \ln(P_i)
\end{equation}

в дискретном случае, и как 

\begin{equation} \label{eq:3:S_cont_def}
S_{c} = - \int_{X} p(x) \ln[p(x)] dx
\end{equation}

в случае непрерывных распределений. 

В данном случае сложность заключаласть в выборе между \eqref{eq:3:S_disc_def} и \eqref{eq:3:S_cont_def} применительно к нашему случаю. Дело в том, что использование \eqref{eq:3:S_disc_def} осложнено тем, что физически в каждый момент времени $t$ есть непрерывное распределение молекул воды $p(t, S)$. Но <<физически>> значит <<в бесконечной системе>>. У нас же количество молекул воды ограничено, поэтому мы лишь оцениваем истинное распределение $p(S)$. Для оценки распределения по конечному количеству измерения необходимо вводить разбиение по оси аргументов, чтобы построить гистограмму, предположительно апроксимирующую целевое распределение. Но не ясно, какое разбиение делать для гистограммы, чтобы найти оптимум между количеством точек в каждом интервале и подробностью разрешения оси. Поэтому от выбора разбиения будет зависить результат, расчитанный по \eqref{eq:3:S_disc_def}. 

Использование же \eqref{eq:3:S_cont_def} осложнено 2 моментами. Во-первых эта формула не совсем безразмерна, т.к. мы берем логарифм от размерной величины (плотность вероятности $p(x)$ имеет размерность $1/[x]$, т.е. в нашем случае $1/nm^2$). Во-вторых, у нас опять же имеется лишь конечное количество молекул воды, что приводит к необходимость как-то оценивать распределение. Было предложено оценивать его, накидывая на каждую точку $r^2(t_i)$ гауссовый купол определенной ширины. Данный метод дает разумную оценку распределения, но имеет свободный параметр в виде ширины <<гауссового пакета>>. Его выбор делает 

\begin{equation}
\sigma = [\max(\{r^2(t_i)\}) - \min(\{r^2(t_i)\})] / N,
\end{equation} 

где $N = |\{r^2(t_i)\}|$ -- количество точек по времени. Для помания такого определения можно обратиться например к случаю свободной диффузии, в котором будет 

\begin{equation}
\sigma \sim D T / N = D N \delta t / N = D \delta t,
\end{equation}

где $\delta t$ -- шаг печати кадров по времени.

Если расписать \eqref{eq:3:S_cont_def} в такой постановке, то можно увидеть, что проблема размерности как и проблема выбора $\sigma$ решаются:

\begin{equation}
\begin{aligned}
& p(x) = \dfrac{1}{\sigma \sqrt{2 \pi}} \sum_{k=1}^N \exp \left( - \dfrac{(x-x_k)^2}{2 \sigma^2} \right) \\
& S = -\int_{\mathcal{R}} p(x) \ln[p(x)] dx \\
\end{aligned} ,
\end{equation}

что упрощается до

\begin{equation} \label{eq:3:Sc_full_simp}
S = N \ln[\sigma \sqrt{2 \pi}] + \sum_{k=1}^N \int_{\mathcal{R}} du \exp \left( - \dfrac{(u-y_k)^2}{2} \right) \ln \left[ \sum_{j=1}^N \exp \left( - \dfrac{(u-y_j)^2}{2} \right) \right],
\end{equation}

где $y_k = x_k / \sigma$.

В данных формулах $x$ -- значения вдоль оси $r^2$, т.к. мы рассматриваем плотность распределения $r^2(t)$, спроецированного на ось $Y$. Тогда $x_k = r^2(t_k)$.

Как видно из \eqref{eq:3:Sc_full_simp}, выражение для $S$ представляется в виде

\begin{equation} \label{eq:3:S_compact}
S = S_0(\sigma, N) + S_{rel}(\sigma, N, \{x_k\}).
\end{equation}

В каждом расчете мы знаем $\sigma$ и $N$ заранее, поэтому можем исключить влияние $S_0(\sigma, N)$. В итоге за энтропию распределения мы будем считать $S_{rel}$ из \eqref{eq:3:S_compact}. Можно предположить, что эффект расмерности не будет давать системного вклада, т.к. для например предельного случая свободной диффузии $x_k \sim k D \delta t / (D \delta t) = k$, что позволяет явно вычислить значения $S_{rel}$ для различных $N$. Результаты вычисления показаны на Рис. \ref{img:3:Srel_bulk}:

\newpage

\begin{figure}[h!]
  \center{\includegraphics[scale=0.65]{Srel_bulk}}
  \caption{Зависимость $S_{rel, bulk}(N)$ в предположении идеальной свободной диффузии, т.е. для $r^2(t) = 6 D t$.}
  \label{img:3:Srel_bulk}
\end{figure}

Видно, что с хорошей точностью $S_{rel,bulk} \approx 2N$, что дает $S_{bulk} \approx N [2 + \ln(D \delta t \sqrt{2 \pi})]$. Поэтому в данной работе за итоговую энтропию бралось $S_c = (S - S_0) / N$. Тогда для чистой воды это значения было бы вычислимо и $S_{c, bulk}\sim 2$.

Типичное распределение молекул в пространстве $(S_c, R)$ показано на Рис. \ref{img:3:RS_dist}:

\newpage

\begin{figure}[h!]
  \center{\includegraphics[scale=0.5]{RS_dist}}
  \caption{Распределение молекул воды в пространстве $S_c, R$.}
  \label{img:3:RS_dist}
\end{figure}

Точки в верхней части распределения смещаются как правило дальше чем остальные, а чем правее точка, тем равномернее проиходит это смещение. Исходя из вида \ref{img:3:RS_dist} было предложено 2 способа клисификации молекул воды как модильных. Первый -- введение 2 граничных значения $R_0, S_0$, и пометка всех молекул с $R > R_0$, $S > S_0$ как мобильных. Это отражено красными линиями. Второй способ -- провесли гауссовую кластеризацию и взять все молекуля, относящиеся в верхней правой группе. По виду зависимости понятно, что изначально нужно искать 2 кластера. Этот метод отражен цветом точек.

Далее мы исследуем 2 предложенных метода кластеризации. Для начала, можно посмотреть на динамику доли <<свободных>> молекул с температурой, что показано на Рис. \ref{img:3:RS_cut_vs_clust}:

\newpage

\begin{figure}[h!]
  \center{\includegraphics[scale=0.5]{RS_cut_vs_clust}}
  \caption{Изменение доли молекул, определяемых как мобильные методами кластеризации и обрезки.}
  \label{img:3:RS_cut_vs_clust}
\end{figure}

По Рис. \ref{img:3:RS_cut_vs_clust} видно, что размер верхнего кластера не зависит от температуры, в то время как с ростом $T$ все больше и больше молекул переходят границу $(> R_0, > S_0)$. Также интересно пронаблюдать динамику движения центра кластера мобильных молекул, показанную на Рис. \ref{img:3:RS_mean_T}:

\begin{figure}[h!]
\subfloat{\includegraphics[scale=0.45]{RS_Rmean_T}}
\subfloat{\includegraphics[scale=0.45]{RS_Smean_T}}
\caption{Движение центра кластера мобильных молекул с изменением температуры.}
\label{img:3:RS_mean_T}
\end{figure}

Соединяя данные с Рис. \ref{img:3:RS_mean_T} и \ref{img:3:RS_cut_vs_clust} можно заключить, что существует кластер молекул, не изменяющийся в размере (Рис. \ref{img:3:RS_cut_vs_clust}), но становящийся более мобильным с ростом температуры (Рис. \ref{img:3:RS_mean_T}). Рост мобильности отражается в основном в стабилизации движения свободных молекул, что ожидаемо, т.к. с ростом температуры потенциальные ямы, мешающие равномерности движения, становятся менее заметня для частиц. Рост же количества мобильных молекул, определяемых методом $R_0, S_0$ объясняется тем, что при росте $T$ хвосты мобильного кластера несимметрично входят в область $(> R_0, > S_0)$, и слева в эту область начинают заползать уже не столь мобильные молекулы. 

Поэтому в итоге было принято решение использовать метод гауссовой кластеризации для определения мобильности молекул.

\subsection{Предположение о природе мобильности}

В разделах выше было найдено 2 кластера молекул воды. Молекулы из одного из которых движутся более свободно чем молекулы из другого. Можно предположить, что попадание молекулы в тот или другой кластер может зависить от степени ее привязанности к белку. Важным механизмом связи воды и белка выступают водородные связи, поэтому они могут играть здесь важную роль. Для оценки доли их вклада в связывание воды можно построить распределение расстояний от молекул воды до белка, что показано на Рис. \ref{img:3:O_prot_dist_distr}:

\newpage

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{O_prot_dist_distr}}
  \caption{Распределения расстояний от центра атома кислорода в молекуле воды до центра ближайшего атома белка. Ораньжевый -- ближайшие соседи ищутся среди всех атомов белка кроме водородов. Синий цвет -- среди всех атомов белка.}
  \label{img:3:O_prot_dist_distr}
\end{figure}

На Рис. \ref{img:3:O_prot_dist_distr} видно, что при включении водородов в состав белка появляется второй пик в распределении на уровне $\sim 2$ \AA, что хорошо согласуется с типичной известной длиной водородной связи.

Преобладание водорода также видно и на распределениях ближайших расстояний по тем элементам, с которыми вода оказалась ближайшим соседом. Они представлены на Рис. \ref{img:3:dist_distr_El}:

\newpage

\begin{figure}[h!]
\subfloat{\includegraphics[scale=0.6]{dist_distr_El_lin}}
\subfloat{\includegraphics[scale=0.6]{dist_distr_El_log}}
\caption{Распределениях ближайших расстояний элементам, с которыми эти расстояния созданы. На левом рисунке видно, что после исключания водорода уже на наблюдается такого явного преобладания соседства с каким-либо одним элементом, что объясняет отсутствие других (кроме длины водородной связи) явных пиков на Рис. \ref{img:3:O_prot_dist_distr}.}
\label{img:3:dist_distr_El}
\end{figure}

Наконец Рис. \ref{img:3:O_prot_dist_distr} как мы считаем позволяет объяснить наличие 2 кластеров на Рис. \ref{img:3:RS_dist} и также поясняет смену режимов динамики молекул воды, показанную еще на Рис. \ref{img:3:r1_displ}.

Итак, можно предположить, что вода, находящаяся в левом пике на расстоянии $\sim 2$ \AA от некоторого водорода в белке будет связана водородной связью и не будет свободно диффундировать. Это порождает участки плато на $r^2(t)$ на Рис. \ref{img:3:r1_displ}. Молекулы же, не связанные водоробной связью, будут двигаться более свободно, что отвечает более равномерным участкам $r^2(t)$ на Рис. \ref{img:3:r1_displ}. О менее связанном состоянии свидетельствует также и отсутствие явного преобладания соседства с каким-либо один элементом после исключения водорода, т.к. если молекула воды просто случайно движется в пространстве, то она будет относительно случайно оказываться ближайшей к разным атомам белка в соответствии с их долей на поверхности. Сравнение Рис. \ref{img:3:dist_distr_El} с долей атомов на поверхлости белка является одной из возможных будущих микро-задач. 

Наличие же 2 кластеров на Рис. \ref{img:3:RS_dist} можно попытаться объяснить тем, что некоторые молекулы чаще оказываются связаны водоробной связью, что мешает их мобтльности. Для проверки данного предположения в будущем можно наложить распределение молекул воды по 2-м пикам на Рис. \ref{img:3:O_prot_dist_distr} на распределение Рис. \ref{img:3:dist_distr_El}.

\section{2-фазное моделирование для учета влажности}
\label{Subsec:ResWater2phase}

Для воспроизведения контакта белок-пар предложено провести 2-фазное моделирование, аналогичное тому что используется для определения фазового равновесия. В одном из направлений периодическая ячейка увеличивается в размере на расстояние, достаточное, чтобы белковые слои, которые по факту все еще нахожится в одной системе, взаимодействовали пренебрежимо мало. По оставшимся 2 осям система не изменяется. В итоге моделируется квази-бесконечный тонкий слой белкового кристалла. Вообще говоря, в рассматриваемом случае действительно будет достигаться фазовое равновесие между водой в белке и в газообразном состоянии. Подобные расчеты позволят более прямо воспроизвести эксперимент \citep{Wang2011} и использовать \eqref{eq:1:mu_balance_final} и \eqref{eq:1:K_explicit} для определения $K$. Они также позволят найти параметры решетки белкового кристалла, естественные для данной влажности.

\subsection{Ограничения малостью системы}

Симуляция в полном $NPT$ ансамбле физически правильна в данной ситуации, т.к. в пределе большой системы (т.е. малых флюктуаций) и большого времени усреднения заранее заданное количество воды в системы бы перераспределилось по следующей схеме:

\begin{enumerate}
\item Заданная температура определяет давление насыщенного пара для данной системы, т.е. для контакта влажный белок -- пар при данной солености воды.
\item Заданное количество воды, изначально находящееся только в белке, определит объем, занимаемый паром:
\begin{enumerate}[label*=\arabic*.]
\item Если целевое давление выше чем давление насыщенного пара, то баростат сожмет всю воду в жидкое состояние, что полностью уберет пар из системы. Лишняя вода будет просто выпадать жидким слоем на поверхностях белкового слоя.
\item Если целевое давление ниже чем давление насыщенного пара, то пар, постепенно испаряясь при данной температуре, начнет преодолевать давление баростата. Это приведет к увеличению объема ячейки, что в свою очередь увеньшит давление пара. Процесс будет повторяться пока в белке не останется количество воды, естественное для данной влажности.
\end{enumerate}
\end{enumerate}

К сожалению, на практике такая схема не реализуется. При полном $NPT$-ансамбле размер ячейки, в котором происходит контакт сред, просто схлопывается, пока не останется упрется в белок, что видно на Рис. \ref{img:3:Lz_collapse}:

\begin{figure}[h!]
\subfloat{\includegraphics[scale=0.4]{Lz_collapse_fast}}
\subfloat{\includegraphics[scale=0.4]{Lz_collapse_slow}}
\caption{Эволюция $L_z$ -- размера ячейки по оси, нормальной к болковому слою -- при различных параметрах термостата. На правом рисунке, при получении которого баростат был искуственно остаблен по оси $Z$, видно, что даже при достаточном для испарения времени баростат все равно схлопывает вакуум.}
\label{img:3:Lz_collapse}
\end{figure}

Из-за эффекта схлопывания вакуума, показанного на Рис. \ref{img:3:Lz_collapse}, было предложено отключить баростат по оси раздела сред. Физически это может привести к тому, что при добавлении слишком большого количества воды она при выходе из белка будет конденсироваться на его поверхности. В реальности данный эффект отсутствует, а в расчете он может быть нивелирован подбором изначального количества воды в системе, которой должно быть недостаточно для заполнения всего вакуума насыщенным паром + насыщение белка водой при данной температуре.

Еще один эффект, тоже возможно порожденный малостью системы, выражается в отсутствии единых стабильных значений постоянных кристаллической решетки. При проведении симуляций, отличающихся только значениями инициализатора случайных чисел, используемого например при генерации начальных скоростей, система может прийти к разным итоговым состояниям, что продемонстрировано на Рис. \ref{img:3:Lxy_not_unique}:

\begin{figure}[h!]
\subfloat{\includegraphics[scale=0.275]{Lxy_1}}
\subfloat{\includegraphics[scale=0.275]{Lxy_2}}
\subfloat{\includegraphics[scale=0.275]{Lxy_3}}
\caption{Эволюция размеров ячейки при одинаковых физических параметрах но различных начальных инициализациях генератора случайных чисел. Ораньжевый -- $L_x$, Зеленый -- $L_y$. Размеры могут как эволюционировать близко, а потом разойтись (рисунок слева), так и наоборот различаться в начале, но потом сойтись (центральный рисунок), так и все время эволюционировать близко (рисунок справа).}
\label{img:3:Lxy_not_unique}
\end{figure}

Скорее всего неединственность итоговой конформации связана с тем, что при малом размере системы  флюктуации структуры происходят эффективно отновременно по всему объему (или в данном случае по всей площади) белкового слоя. А такие глобальные флюктуации могут оказаться более устойчивыми из-за крупномасштабного самодействия, отсутствующего в реальной системе. Из-за данной неединственности затруднительно говорить о зависимости равновестных значений объема или отдельных размероя ячейки от температуры. Предположительно при увеличении расчетной ячейки на большее количество элементарных ячеек белка эффект должен исчеснуть, ли по крайне мере должна появиться какая-то одна явно преобладающая конформация. Это является одним из направлений дальшейнего исследования. Данный эффект может быть важен непосредственно для определения равновестных размеров ячейки при заданной влажности. 

\subsection{Расчет относительной влажности}

Размер ячейки играет ключевую роль в обоих прямых методах расчета $K$, т.к. динамический метод опирается на флюктуации объема, а в статическом происходит одномоментное изменение объема. Для ресчетов же по \eqref{eq:1:mu_balance_final} точное значение размеров ячейки не играет очевидно-важной роли, т.к. в \eqref{eq:1:mu_balance_final} явно участвуют лишь относительная влажность и массовая доля воды в системе. К тому же данный метод использовался в эксперименте \citep{Wang2011}.

Опишем алгоритм построения изотерм, аналогичных Рис. \ref{img:1:K_measure}. Начальными данными является температура системы, изначальное количество воды, содержащейся на старте симуляции только внутри белка, и толщина слоя вакуума. Был выбран слой вакуума в 25 нм., т.к. обычно белки заметно влияют друг на друга если находятся ближе $\sim 10$ нм.. 

По молекулярно-динамической траектории строится эволюция профиля плотности воды по оси $Z$, т.е. по нормали к границе раздела сред. Типичный профиль в установившемся состоянии изображен на Рис. \ref{img:3:rho_Z_stab}:

\begin{figure}[h!]
  \center{\includegraphics[scale=0.65]{rho_Z_stab}}
  \caption{Типичный профиль плотности молекул воды в установившемся состоянии. Усреднение проводилось по отрезку траектории в 20 нс. В систему добавлялось по 450 молекул воды на элементарную ячейку, содержащую 8 цепей лизоцима, к 1656 молекулам на ячейку, уже имеющимся на рентгеновских данных.}
  \label{img:3:rho_Z_stab}
\end{figure}

Отметим, что на подобных профилях видно формирование слоя воды, которая вышла из белка но уже не смогла поднимать плотность пара выше плотности насыщенного при данной температуре, что продемонстрировано на Рис. \ref{img:3:rho_Z_stab_manyW}.

\begin{figure}[h!]
  \center{\includegraphics[scale=0.65]{rho_Z_stab_manyW}}
  \caption{Профиль аналогичный Рис. \ref{img:3:rho_Z_stab}, но добавляется не 450 молекул воды на ячейку, а 1354. Можно видеть увеличения плотности воды по краям белкового слоя, которые свидетельствуют о конденсации воды, не влезшей ни в белок ни в вакуум в газообразном состоянии.}
  \label{img:3:rho_Z_stab_manyW}
\end{figure}

Плотность насыщенного пара при данной температуре, отмеченная на профилях плотности выше и используемая далее для построения изотерм, рассчитана фитированием функции вида

\begin{equation} \label{eq:3:rho_sat_general}
\rho_{sat}(T) = \exp \left( a - \dfrac{b}{T} \right) T^{-c},
\end{equation}

где $a$, $b$, $c$ -- подбираемые параметры, на данных зависимости плотности насыщенного пара воды tip4p/2005 в контакте с чистой водой \citep{Bauer2009}. Вид зависимости \eqref{eq:3:rho_sat_general} получается из уравнения Клапейрона-Клаузиуса при пренебрежении удельным объемом жидкости и принятии модели идеального газа для пара и постоянства теплоемкостей газа и жидкости на исследуемом диапазоне температур.

Общий вид уравнения Клапейрона-Клаузиуса записывается как 

\begin{equation}
\dfrac{dP}{dT} = \dfrac{q}{T(v_1 - v_2)},
\end{equation}

где $v_1$, $v_2$ -- удельные (по массе) объемы фаз, $q$ -- удельная теплота перехода. В силу $\rho_{vap} \ll \rho_{liq}$ можно сказать что $v_{vap} / v_{liq} = \rho_{liq} / \rho_{vap} \gg 1$. Далее, принимая модель идеального газа для пара, получаем $v_{vap} = V_{vap} / m_{vap} = \nu R T / P \nu \mu = R T / P \mu$, получаем

\begin{equation}
\dfrac{dP}{dT} = \dfrac{P q \mu}{R T^2},
\end{equation}

где $\mu$ -- молярная масса вещесва, претерпечающего переход, $q$ -- удельная теплота перехода. Она складывается из внутренней энергии и работы по расширению пара при нагревании:

\begin{equation}
q = u_{vap} - u_{liq} + P(v_{vap} - v_{liq}).
\end{equation}

Принимая $u = u_1 + \int_{T_1}^T c_v dT$, $c_v = c_P - R/\mu$ получаем

\begin{equation}
\dfrac{dP}{dT} = \dfrac{P \mu [q_1 + (c_{P,vap} - c_{liq})(T - T_1)]}{R T^2},
\end{equation}

откуда интегрированием по $T$ получается \eqref{eq:3:rho_sat_general}.

На профилях плотности видно, что можно считать плотностью пара среднее значение плотности по области $z \in [0; 9] \cup [25; 32]$ нм. Таким образом были получены зависимости плотности пара  от времени для 2-фазной системы. Было обнаружено, что вычисление изотерм, аналогичных Рис. \ref{img:1:K_measure}, может требовать заметно бОльших времен релаксации чем вычисление $K$ прямым методом. Дело в том, что в системе происходят процессы релаксации с разными характерными временами. Обычно для стабилизации плотности пара при тощине слоя вакуума в 25 нм. требовалось около 30  нс., что продемонстрировано на Рис. \ref{img:3:rhoW_40ns}:

\begin{figure}[h!]
  \center{\includegraphics[scale=0.65]{rhoW_40ns}}
  \caption{Зависимость протности пара от времени для $T = 35$ $C^{\circ}$. Время усреднения для каждой точки -- 5 нс. Видно, что примерно 30 нс. достаточно для стабилизации зависимости.}
  \label{img:3:rhoW_40ns}
\end{figure}

Однако оказывается, что в системе происходят и заметно более долгие процессы, т.к. при увеличении времени симуляции на порядок мы видим изменение плотности пара, что изображено на Рис. \ref{img:3:rhoW_400ns}:

\begin{figure}[h!]
  \center{\includegraphics[scale=0.65]{rhoW_400ns}}
  \caption{Зависимость протности пара от времени для $T = 35$ $C^{\circ}$. Время усреднения для каждой точки -- 10 нс. Видно, что примерно на моменте 250 нс. начинает проиходить качественное изменение в системе.}
  \label{img:3:rhoW_400ns}
\end{figure}

\subsection{Расчет $K$ из баланса хим. потенциала}

Учитывая особенности вычисления относительной влажности, описанные в предыдущем разделе, мы наконец можем построить изотермы вида \eqref{eq:1:mu_balance_final} и найти по ним значения $K$ белка.

Вычисление $K$ по \eqref{eq:1:mu_balance_final} требует проведения нескольких расчетов длительностью по несколько сотен нс. каждый, поэтому на данный момент результатов, полученных этим методом не много. Результаты расчетов для $T = 18$ $C^{\circ}$ представлены на Рис. \eqref{img:3:yx_T18}.

\begin{figure}[h!]
  \center{\includegraphics[scale=0.65]{yx_T18}}
  \caption{Изотерма вида \eqref{eq:1:mu_balance_final}, расчитанная для $T = 18$ $C^{\circ}$. Линейная апроксимация на всем интервале делает потому, что интервал изначально подбирался так, чтобы на экспериментальной зависимости Рис. \ref{img:1:K_measure} при данных массовых долях воды зависимость \eqref{eq:1:mu_balance_final} действительно была линейной. Для наглядности нанесена также линия с наклоном, соответствующем экспериментальному значению $K$ при данной температуре \citep{Wang2011}.}
  \label{img:3:yx_T18}
\end{figure}

С одной стороны расхождение расчетных значений с экспериментальными все еще в несколько раз. Но с другой стороны результат расчетов по данному методу ошибается заметно меньше чем оба испытанных прямых метода -- ошибка в 5 раз против 20 раз. Тут стоит упомянуть, что в самом эксперименте \citep{Wang2011} авторы указывают на неизвестный параметр -- долю атомов белка, участвующих в смешивании с водой. Ваирация этого параметра в пределах, выбранных авторами эксперимента, приводит к изменению получаемого $K$ до 2 раз.


%\section{Анализ мобильности молекул воды}
%\label{Subsec:ResWaterMob}

%2

