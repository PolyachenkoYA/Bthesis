\chapter{Результаты моделирования}
\label{Sec:Results}

В этой главе приведены результаты и анализ расчётов.

В разделе \ref{Subsec:KdirectMethodsVer} предложенные выше методы расчета $K$ проверяются на работоспособность на простой системе чистой воды.

Далее в разделе \ref{Subsec:BarostatTermostat} обсуждается теория баро- и термо-статирования, результаты применения которых затем проверяются на сходимость в разделе \ref{Subsec:KconvBaroTermo}.

Значения $K$ расчитаны в разделе \ref{Subsec:Kcomp}. Обсуждаются возможные причины разхождения с эксмерипентом. В разделе \ref{Subsec:ResWater2phase} делается попытка исправить одну из возможных причин расхождения -- неверный процесс релаксации системы перед расчетами -- при помощи проведения 2-фазного моделирования для нахождения равновестных параметров системы.

\section{Верификация прямых методов расчета $K$}
\label{Subsec:KdirectMethodsVer}

Преждем чем применять методы \eqref{eq:2:K_dV_def} и \eqref{eq:2:K_fluct_def} для <<сложной>> системы воды+белок, надо проверить их на более простом примере. Например для воды хорошо известно экспериментальное значение $K$. К тому же, вода будет участвовать и в целевом расчете, поэтому проверить ее адекватное воспроизведение хотя бы в чистом виде все равно необходимо. Тут, как и далее, используется модель воды tip4p/2005 \citep{Abascal2005}. Выбор в пользу более сложной модели воды вместо часто используемых в симуляциях белков SPC/E \citep{Berendsen1981, Berweger1995, Berendsen1987} и tip3p \citep{Jorgensen1983, Neria1996} сделан потому, что эффект роста $K$ при уменьшении температуры наблюдается на мастшабах $\sim 10 K$, в то время как даже такие менее тонкие эффеекты как например температура кристализации воды занижается моделью SPC/E на $\sim 50K$. 

На Рис. \ref{img:3:water_test_2methods} приведено сравнение экспериментального $K$ с рассчитанными по \eqref{eq:2:K_dV_def} и \eqref{eq:2:K_fluct_def}. Флюктуационный метод совпадает с экспериментом в пределах погрешности, но эта погрешность достаточно велика $\sim 10\%$. Метод малых смещений дает меньшую погрешность, и дает отклонение от эксперимента на $\sim 5\%$. 

\begin{figure}[h!]
  \center{\includegraphics[scale=0.5]{water_test_2methods}}
  \caption{Сравнение $K$, полученных 2 прямыми методами \eqref{eq:2:K_dV_def} и \eqref{eq:2:K_fluct_def}, с экспериментальными значениями. $t_{stab}$ -- время в начале моделирования, отбрасываемое при анализе. Как видно, система из чистой воды воспроизводит естественные флюктуации уже после 0.25 нс. эволюции.}
  \label{img:3:water_test_2methods}
\end{figure}

\section{Используемые баростат и термостат}
\label{Subsec:BarostatTermostat}

Численное решение неизмененных уравнений Ньютона приводит к симуляции NVE ансамбля, однако часто бывает интересно поведение системы в других условиях, таких как NVT и NPT. Их вспроизведения в расчете не так тривиально. Например, существуют достаточно идейно-простые методы термостатирования системы, такие как термостат Берендсена. Физически он заключается в насильном выполнении

\begin{equation} \label{eq:3:Berendsen_diff_form}
\dfrac{dT}{dt} = \dfrac{T_0 - T}{\tau},
\end{equation}

где $T$ -- текущая температура системы, $T_0$ -- целевая температура, $t$ -- время, $\tau$ -- характерное время релаксации системы к целевой температуре.

При дискретизации \eqref{eq:3:Berendsen_diff_form} апроксимируется \citep{Berendsen1991} масштабированием скоростей частиц на фактор 

\begin{equation}
\lambda = \sqrt{ 1 + \left( \dfrac{T_0}{T} - 1 \right) \dfrac{\Delta t}{\tau_T} }, \hspace{10pt} \tau_T = \tau \dfrac{3 N_{df} k_B / 2}{C_V},
\end{equation}

где $C_V$ -- молярная теплоемкость системы при постоянном объеме, $N_{df}$ -- количество степеней свободы в системе.

Проблема таких <<наивных>> подходов заключается в том, что они как правило искажают распределение частиц в фазовом пространстве таким образом, что средние значения термодинамических величин не затрагиваются, но флюктуации и тем более высшие моменты начинают расходится с естественным поведением моделируемых ансамблей. В случае термостатирования эта проблема решается термостатом Нозе-Гувера \citep{Nos1984, Hoover1985}. Его идея состоит в модификации уравнений движения путем введения дополнительной степени свободы $s$ <<резервуара>>, с которым связана динамика всех реальных частиц системы:

\begin{equation} \label{eq:3:NoseHooverIdea}
\begin{aligned}
& \frac{\mathrm{d}^{2} \boldsymbol{r}_{i}}{\mathrm{~d} t^{2}}=\frac{\boldsymbol{F}_{i}}{m_{i}}-\frac{p_{s}}{Q} \frac{\mathrm{d} \boldsymbol{r}_{i}}{\mathrm{~d} t} \\
& \frac{\mathrm{d} p_{s}}{\mathrm{d} t}= \dfrac{N_{df} k_B (T-T_{0})}{Q} \\
\end{aligned}.
\end{equation}

Как видно, при $T > T_0$ коэффициент трения положителен и энергия диссипирует, т.к. $T$ уменьшается. При $T < T_0$ же наоборот происходит разгон частиц т.к. <<трение>> отрицательно. Это порождает затухающие осциляции температуры около целевого значения. Характерный период осцилляций

\begin{equation}
\tau_T \sim 2 \pi \sqrt{\dfrac{Q}{2 N_{df} k_B T}}
\end{equation}

Уравнения \eqref{eq:3:NoseHooverIdea} не гамильтоновы, но можно показать \citep{Nos1984}, что гамильтониан

\begin{equation} \label{eq:3:NoseHooverHfull}
\begin{aligned}
& \mathcal{H}_0(\mathbf{p}, \mathbf{r}) = \sum_{i=1}^{N} \frac{\boldsymbol{p}_{i}^2}{2 m_{i}}+U\left(\boldsymbol{r}_{1}, \boldsymbol{r}_{2}, \ldots, \boldsymbol{r}_{N}\right) \\
& \mathcal{H}(\mathbf{p}, \mathbf{r}, p_s, s)=\mathcal{H}_0\left(\dfrac{\mathbf{p}}{s}, \mathbf{r}\right)+\frac{p_{s}^{2}}{2 Q}+N_{df} k_B T \ln(s) \\
\end{aligned}
\end{equation}

приводит к системе, аналогичной \eqref{eq:3:NoseHooverIdea} в переменных $(q, p / s)$. 

Наличие гамильновой формулировки позволяет применить формализм расложения Троттера для оператора эволюции системы, что в свою очередь позволяет без затружнений выписывать численные схемы, аналогичные схемам Verlet, для сложных ансамблей \citep{Martyna1996}.

При этом симуляция \eqref{eq:3:NoseHooverHfull} в $NVE$ (точнее $NV\mathcal{H}$) ансамбле будет соответствовать симуляции невозмущенной системы $\mathcal{H}_0$ в $NVT$. Это происходит потому, что $NV\mathcal{H}$-статсумма системы

\begin{equation}
Z_{N-H}=\frac{1}{N !} \int d p_{s} \int d s \int d \mathbf{p} \int d \mathbf{r} \hspace{3pt} \delta\left[\mathcal{H}(\mathbf{p}, \mathbf{r}, p_s, s)-E\right]
\end{equation}

представляется \citep{Nos1984} как

\begin{equation}
\begin{aligned}
& Z_{N-H}=\frac{1}{N_{df}+1}\left(\frac{2 \pi Q}{k T_{0}}\right)^{1 / 2} \exp \left( \dfrac{E}{k_B T_{0}}\right) Z_{NVT}\left(\dfrac{\mathbf{p}}{s} , \mathbf{r}\right) \\
& Z_{NVT}\left(\mathbf{p} , \mathbf{r}\right)=\frac{1}{N !} \int d \mathbf{p} \int d \mathbf{r} \exp \left[- \dfrac{\mathcal{H}_0\left(\mathbf{p}, \mathbf{r}\right)}{k_B T_{0}}  \right] \\
\end{aligned},
\end{equation}

что при усреднении любой термодинамической величины, зависящей от $\left(\mathbf{p}/s, \mathbf{r}\right)$, эффективно приведет к усреднению лишь по $Z_{NVT}\left(\mathbf{p}/s, \mathbf{r}\right)$, что как раз эквивалентно симуляции $NVT$ ансамбля. Выражаясь более строго,

\begin{equation}
\left\langle A\left(\frac{\mathbf{p}}{s}, \mathbf{r}\right)\right\rangle_{N-H}=\left\langle A\left(\mathbf{p}, \mathbf{r}\right)\right\rangle_{NVT}
\end{equation}

Следует уточнить, что реально используемая схема принципиально следует изложенной идее, но не точно ее повторяет. Дело в том, что уравнения \eqref{eq:3:NoseHooverIdea} могут быть не эргодичны, и есть примеры, когда это действительно так \citep{Cooke2008}. Для решения этой проблемы предложено использовать цепи Нозе-Гувера \citep{Martyna1992}. Добавление даже нескольких звеньев уже существенно улучшает эргодичность, хотя и не делает ее математически точной. Доказано, что при стремлении количества цепей к бесконечности динамика системы будет эргодичной. В расчетах используется цепь из 10 звеньев, как достаточная для подавляющего большинсва расчетов. Внимательно рассматривать значения этого параметра может быть разумно при проведении термодинамического интегрирования, чего в нашем случае не происходит, поэтому используется стандартное значение. 

Для приложения внешних напряжений так же существуют как более интуитивные методы, которые однако не воспроизводят динамику системы со всей полнотой, так и более сложные методы, которые доказано моделируют $NPT$ ансамбль.

Например есть аналог термостата Берендсена \citep{Berendsen1984}, реализующий теперь идею 

\begin{equation}
\frac{\mathrm{d} \hat{P}}{\mathrm{d} t}=\frac{\hat{P}_{0}-\hat{P}}{\tau_{p}},
\end{equation}

которая при дискретизации реализуется масштабированием ячейки и коордитам всех аотом в ней с помощью метрицы

\begin{equation}
\mu_{i j}=\delta_{i j}-\frac{\Delta t}{3 \tau_{p}} \beta_{i j}\left\{P_{0 i j}-P_{i j}(t)\right\},
\end{equation}

где $\beta_{ij}$ -- тензор изотермической сжимаемости, определяемый как \citep{Parrinello1981}

\begin{equation} \label{eq:3:beta_def}
\beta_{ij} \Delta P = \varepsilon_{ij} = \dfrac{1}{2} \left[ (\hat{h} \hat{h}_0^{-1})^T \hat{h} \hat{h}_0^{-1} - 1 \right],
\end{equation}

$\hat{h} = \{\mathbf{a},\mathbf{b},\mathbf{c}\}$ -- матрица, составленная из базисных векторов периодической расчетной ячейки, $\hat{h}_0$ -- равновесное положение ячейки.

Качественно понять определение \eqref{eq:3:beta_def} можно так. Если $\hat{h}$ и $\hat{h}_0$ диагональны, то можно перейти к рассмотрению деформации по одной произвольно выбранной оси, а по остальным рассуждения будут аналогичны. При проекции на 1 ось диагональные $\hat{h}$ и $\hat{h}_0$ переходят в $L = L_0 + \Delta L$ и $L_0$ соответственно, что дает при выборе например оси $X$:

\begin{equation}
\beta_{xx} \Delta P = \dfrac{1}{2} \left[ \left( \dfrac{L_0 + \Delta L}{L_0} \right)^2 - 1 \right] \approx \dfrac{\Delta L}{L_0} \Rightarrow \beta_{xx} = \dfrac{1}{L_0} \dfrac{\Delta L}{\Delta P} \sim \left. \left( \dfrac{1}{L} \dfrac{\partial L}{\partial P} \right) \right|_{L = L_0}
\end{equation}

Как и в случае в термостатом Берендсена, данный алгоритм относительно прост, однако воспроизводимая им динамика вообще говоря отличается от естественной, хотя и не изменяет средние значения термодинамических величин.

Парринело и Рахман \citep{Parrinello1981} предложили подход, аналогичный подходу Нозе-Гувера. Уравнения движения системы модифицируются как

\begin{equation}
\begin{aligned}
& \frac{\mathrm{d}^{2} \boldsymbol{r}_{i}}{\mathrm{~d} t^{2}}=\frac{\boldsymbol{F}_{i}}{m_{i}}-\left[ \hat{h}^{-1} \dfrac{\mathrm{d} \hat{h}}{\mathrm{d} t} + \left( \hat{h}^{-1} \dfrac{\mathrm{d} \hat{h}}{\mathrm{d}t} \right)^{T} \right] \frac{\mathrm{d} \boldsymbol{r}_{i}}{\mathrm{~d} t} \\
& \frac{\mathrm{d} \hat{h}^{2}}{\mathrm{~d} t^{2}}=V \hat{W}^{-1} (\hat{h}^T)^{-1}\left(\hat{P}-\hat{P}_{0}\right) \\
\end{aligned},
\end{equation}

где $V$ -- объем системы, $\hat{W}$-- параметр силы баростата, аналом массы для степеней свободы размеров периодической ячейки.

Эти уравнения сохраняют гамильтониан

\begin{equation} \label{eq:3:PR_hamiltonian}
\mathcal{H}_{P-R} = \sum \dfrac{m_i \mathbf{v}_i^2}{2} + U(\mathbf{r}_1, \ldots \mathbf{r}_N) + \dfrac{Tr(\dot{\hat{h}}^T \hat{W} \dot{\hat{h}})}{2} + \dfrac{Tr(\hat{P})}{3} \det(\hat{h}),
\end{equation}

где $\mathbf{v}_i$ учитывает только движение частицы внутри ячейки, но не изменение самой ячейки. Т.е. если представить $\mathbf{r} = \hat{h} \mathbf{s}$, то $\mathbf{v} = \hat{h} \dot{\mathbf{s}}$, но не $\hat{h} \dot{\mathbf{s}} + \dot{\hat{h}} \mathbf{s}$.

Гамильтониан \eqref{eq:3:PR_hamiltonian} равен энтальпии системы $H$ с точностью $\sim 1/N$, что как раз приводит $NP\mathcal{H}_{P-R}$ ансамбль к $NPH$ ансамблю.

Параметр $\hat{W}$ не очень интуитивен, поэтому полезно указать его связь с более явными величинами:

\begin{equation}
\left(\hat{W}^{-1}\right)_{i j}=\frac{4 \pi^{2} \beta_{i j}}{3 \tau_{p}^{2} \max(\{L_k\})},
\end{equation}

где $L_k$ -- размеры ячейки.

\section{Сходимость $K$ по параметрам термостата и баростата}
\label{Subsec:KconvBaroTermo}

Как упоминалось выше, расчет термодинамических величин, таких как $K$, при активном термо- или баро-статировании может сказаться на полечаемых результатах. Поэтому прежде чем проводить вычислительные измерения $K$, нам нужно найти такие параметры термостата и баростата $\tau_T$, $\tau_P$ (являющиеся параметрами, отсутствующими в реальности), чтобы получаемые значения $K$ уже не зависили от них. Также должа быть достигнута сходимость $K$ по времени усреднения.

Такой анализ был проведен, и его результаты приведены на Рис. \ref{img:3:tau_conv}:

\begin{figure}[h!]
\subfloat{\includegraphics[scale=0.6]{tau_conv_t20}}
\subfloat{\includegraphics[scale=0.6]{tau_conv_t40}}
\caption{Проверка сходимости $K$ по силе баростата и термостата для флюктуационного метода расчета \eqref{eq:2:K_fluct_def}. Для уменьшения количества пробных расчетов одновременно менялись силы баростата и термостата, что отражено как $\tau_T = \tau_P/4$. Погрешности точек размеров с символы точек. Синие точки - анализ расчетных данных, проведенный в данной работе. Красные точки - значения, автоматически расчитываемые Громаксом. Отличие обсуждается ниже.}
\label{img:3:tau_conv}
\end{figure}

Видно, что времени усреднения 20 нс. не хватает чтобы получать стабильные $K$ при любой силе внешнего создействия. Времени же в 40 нс. уже достаточно. На том же графике для 40 нс. видна граница силы воздействия, после которой зависимость от силы термостата пропадает. Но делать теостат слишком слабым тоже не оптимально, т.к. это скажется на скорости уменьшения погрешностей точек, что приведет к необходимости заметно увеличивать время симуляции. В итоге было выбрано значение $\tau_P = 128$ нс. и соответствующее значение $\tau_T$.

На Рис. \ref{img:3:tau_conv} так же присутствуют красные точки, отвечающие значением $K$, автоматически вычисленным пакетом GROMACS \citep{Abraham2015}. В нем используется так же формула \eqref{eq:2:K_fluct_def}, но отличие состоит в том, что Громакс не учитывает начилие начального этапа релаксации. Причина наглядно пояснена на Рис. \ref{img:3:Vt_gromacsVSme}.

\begin{figure}[h!]
  \center{\includegraphics[scale=0.5]{Vt_gromacsVSme}}
  \caption{Сравнение реализаций расчета $K$ по \eqref{eq:2:K_fluct_def}, использовыннах в данной работе и автоматически проводимых Громаксом. Громакс использует для расчета $\langle \Delta V^2 \rangle$ вся траекторию, не учитывая начальный этап релаксации. Это приводит к завышению $\langle \Delta V^2 \rangle$, что наглядно видно на рисунке -- во время релаксации колебания объема значительно больше чем в расновестном состоянии. И чем слабее баростат, тем дольше занимает этап релаксации, и соответственно тем больше завышается значение $\langle \Delta V^2 \rangle$, что все больше занижает значения $K$. Этот эффект явно виден на Рис.  \eqref{img:3:tau_conv}}
  \label{img:3:Vt_gromacsVSme}
\end{figure}

Для метода малых смещений \eqref{eq:2:K_dV_def} нужно провести аналогичную проверку по сходимости параметров метода. В данном случае это малость изменения объема и сила термостата, выражаемая $\tau_T$. Результаты тестов представлены на Рис. \ref{img:3:dV_conv}

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{dV_conv}}
  \caption{Проверка сходимости метода расчета $K$ малыми смещениями \eqref{eq:2:K_dV_def} по малости изменения объема и по силе термостата. Для согласованности было использовано время усреднения 40 нс., т.к. выше было найдено, что это время оптимально для расчетов по флюктауционному методу. Видно, что в области $\tau_T > 32$ нс., $dV/V > 10^{-2.5}$ значения $K$ стабильны в пределах погрешности. }
  \label{img:3:dV_conv}
\end{figure}

Для флюктуационного метода выше было выбрано $\tau_T = 32$ нс., поэтому здесь для согласованности мы взяли то же значение, т.к. оно входит в область плато, указанную на Рис. \ref{img:3:dV_conv}. Значение $dV$ было выбрано минимально возможным еще входящим в плато из соображений наименьшего искуственного возмущения системы. Можно было бы пытаться увеличивать время усреднения, и таким образом получать плато на еще меньших значениях $dV$, т.к. ошибка возникает из-за того что при малых $dV$ ожидаемое изменение $dP$ также мало, поэтому хуже регистрируется при малом усреднении. Но чтобы уменьшить допустимое $dV$ на пол порядка, нужно увеличить время усреднения в 10 раз. Поэтому было решено оставить время усреднения и выбрать $dV$ достаточно большое, что этого времени хватало для различения $dP$, т.е. в данном случае $dV/V = 10^{-2.5}$.

\section{Расчет $K$ прямыми методами}
\label{Subsec:Kcomp}

Получив сходимость по нефизичным параметрам методов, мы можем наконец применить их для расчета $K$ белка при различных температурах. Используются ранее выбранные параметры методов:

\begin{itemize}
\item NVT: $dV/V \sim 10^{-2.5}$, $\tau_T = 32$ нс., $t_{avg} = 40$ нс.
\item NPT: $\tau_P = 128$ нс., $\tau_T = 32$ нс., $t_{avg} = 40$ нс.
\end{itemize}

Так же используется метод определения количества воды в системе, описанный в разделе \ref{Subsec:CalculationConverge}, основанный на подборе количества воды для достижения экспериментального давления.

Результаты расчетов представлены на Рис. \ref{img:3:K_T_0}:

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{K_T_0}}
  \caption{Результаты расчета $K$ прямыми методами \eqref{eq:2:K_dV_def} и \eqref{eq:2:K_fluct_def} при гадратации по \ref{Subsec:CalculationConverge}. Методы дают согласованный результат, что говорит в пользу корректности полученных результатов.}
  \label{img:3:K_T_0}
\end{figure}

Из-за самосогласованности результатов, полученных 2 независимыми методами, можно говорить о физичности расчитываемого $K$. Однако, полученные значения заметно отличаются от экспериментальных, что демонстрируется на Рис. \ref{img:3:K_T_0_with_exp}:

\begin{figure}[h!]
  \center{\includegraphics[scale=0.8]{K_T_0_with_exp}}
  \caption{Сравнение значений $K$, расчитанных двумя методами, с экспериментальными значениями. Кресты (exp 1) -- работа \citep{Wang2011}, Круги (exp 2) -- \citep{Gorelov1987}. Возможные причины расхождения обсуждаются далее.}
  \label{img:3:K_T_0_with_exp}
\end{figure}

У данного расхождения может быть множество причин, и их исследование составляет нижеизложенную часть представленной работы и имеет перспективу для дальнейшего развития.

Одной из возможных причин может быть то, что используемая параметризация белка не воспроизводит именно $K$. В расчетах использовалась параметризация amber03 \citep{Duan2003} с моделью воды tip4p/2005 \citep{Abascal2005}. Как упоминалось выше, вода предположительно \citep{Wang2011} играет важную роль в эффекте излома зависимости $K(T)$, в то время как стандартные модели воды SCP/E и tip3p воспроизводят даже такой параметр как температуру кристализации с недопустимой в данном случае ошибкой. Поэтому было решено использовать воду tip4p, которая воспроизводит по крайне мере фазовую диаграмму с приемлимой в данном случае точностью. Выбор данной модели воды же повлек использование параметризации amber03, т.к. именно она проверенно согласованна с водой tip4p/2005. 

Параметры потенциала amber03 были получены из квантовомеханических расчетов. Верификация же проводилась сравнением карт Рамачандрана углов полипептидной связи. Авторам не известно о тестах потенциала amber03, подтверждающих воспроизведение им упругих свойств Лизоцима, поэтому это может не иметь места с достаточной точностью. Можно привести кафественные рассуждения, почему воспроизведение карт Рамачандрана не обязано свидетельствовать об ожидаемых упругих свойствах кристалла. Дело в том, что карты Рамачандрана характеризуют равновесное состояние белка, т.е. распределение средних значений углов полипептидной связи. Упругие же свойсва при малых деформациях будут зависеть не от равновесных значений углов, а от резкости потенциальных ям, в которых находятся эти средние значения. Об этом говорит возможность расчета $K$ из флюктуаций объема, т.е. из динамической характеристики. А поэтому карты рамачандрана зависят не совсем от тех же сочетаний параметров потенциала, от которых зависит $K$, что значит, что из воспроизведение не так жеско связано с воспроизведением $K$. Стоит однако заметить, что заметная корреляция должна быть, поскольку большое количество совпавших с экспериментом точек на карте рамачандрана накладывает много ограничений на возможные значения параметров потенциала.

Другой возможной причиной мы считаем неверную работу с водой в системе. Дело в том, что в эксперименте порошок лизоцима находился в равновесии с водяными парами. Поэтому если мы воспроизведем контакт сред пар-белок в расчете, то система сама может прийти к правильному количеству воды в белке, вытеснив лишнюю воду в соответствующий объем изначально пустого пространства.

\section{2-фазное моделирование для учета влажности}
\label{Subsec:ResWater2phase}

Для воспроизведения контакта белок-пар предложено провести 2-фазное моделирование, аналогичное тому что используется для определения фазового равновесия. В одном из направлений периодическая ячейка увеличивается в размере на расстояние, достаточное, чтобы белковые слои, которые по факту все еще нахожится в одной системе, взаимодействовали пренебрежимо мало. По оставшимся 2 осям система не ихменяется. В итоге моделируется квази-бесконечный тонкий слой белкового кристалла. Вообще говоря, в рассматриваемом случае действительно будет достигаться фазовое равновесие между водой в белке и в газообразном состоянии. Подобные расчеты позволят более прямо воспроизвести эксперимент \citep{Wang2011} и использовать \eqref{eq:1:mu_balance_final} и \eqref{eq:1:K_explicit} для определения $K$. Они также позволят найти параметры решетки белкового кристалла, естественные для данной влажности.

\subsection{Ограничения малостью системы}

Симуляция в полном NPT ансамбле физически правильна в данной ситуации, т.к. в пределе большой системы (т.е. малых флюктуаций) и большого времени усреднения заранее заданное количество воды в системы бы перераспределилось по следующей схеме:

\begin{enumerate}
\item Заданная температура определяет давление насыщенного пара для данной системы, т.е. для контакта влажный белок -- пар при данной солености воды.
\item Заданное количество воды, изначально находящееся только в белке, определит объем, занимаемый паром:
\begin{enumerate}[label*=\arabic*.]
\item Если целевое давление выше чем давление насыщенного пара, то баростат сожмет всю воду в жидкое состояние, что полностью уберет пар из системы. Лишняя вода будет просто выпадать жидким слоем на поверхностях белкового слоя.
\item Если целевое давление ниже чем давление насыщенного пара, то пар, постепенно испаряясь при данной температуре, начнет преодолевать давление баростата. Это приведет к увеличению объема ячейки, что в свою очередь увеньшит давление пара. Процесс будет повторяться пока в белке не останется количество воды, естественное для данной влажности.
\end{enumerate}
\end{enumerate}

К сожалению, на практике такая схема не реализуется. При полном NPT-ансамбле размер ячейки, в котором происходит контакт сред, просто схлопывается, пока не останется упрется в белок, что видно на Рис. \ref{img:3:Lz_collapse}:

\begin{figure}[h!]
\subfloat{\includegraphics[scale=0.4]{Lz_collapse_fast}}
\subfloat{\includegraphics[scale=0.4]{Lz_collapse_slow}}
\caption{Эволюция $L_z$ -- размера ячейки по оси, нормальной к болковому слою -- при различных параметрах термостата. На правом рисунке, при получении которого баростат был искуственно остаблен по оси $Z$, видно, что даже при достаточном для испарения времени баростат все равно схлопывает вакуум.}
\label{img:3:Lz_collapse}
\end{figure}

Из-за эффекта схлопывания вакуума, показанного на Рис. \ref{img:3:Lz_collapse}, было предложено отключить баростат по оси раздела сред. Физически это может привести к тому, что при добавлении слишком большого количества воды она при выходе из белка будет конденсироваться на его поверхности. В реальности данный эффект отсутствует, а в расчете он может быть нивелирован подбором изначального количества воды в системе, которой должно быть недостаточно для заполнения всего вакуума насыщенным паром + насыщение белка водой при данной температуре.

Еще один эффект, тоже возможно порожденный малостью системы, выражается в отсутствии единых стабильных значений постоянных кристаллической решетки. При проведении симуляций, отличающихся только значениями инициализатора случайных чисел, используемого например при генерации начальных скоростей, система может прийти к разным итоговым состояниям.

\begin{figure}[h!]
\subfloat{\includegraphics[scale=0.275]{Lxy_1}}
\subfloat{\includegraphics[scale=0.275]{Lxy_2}}
\subfloat{\includegraphics[scale=0.275]{Lxy_3}}
\caption{Эволюция размеров ячейки при одинаковых физических параметрах но различных начальных инициализациях генератора случайных чисел. Ораньжевый -- $L_x$, Зеленый -- $L_y$. Размеры могут как эволюционировать близко, а потом разойтись (рисунок слева), так и наоборот различаться в начале, но потом сойтись (центральный рисунок), так и все время эволюционировать близко (рисунок справа). Скорее всего это связано с }
\label{img:3:Lxy_not_unique}
\end{figure}


%\section{Анализ мобильности молекул воды}
%\label{Subsec:ResWaterMob}

%2

