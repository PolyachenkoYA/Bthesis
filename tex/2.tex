\chapter{Построение МД модели кристалла Лизоцима}
\label{Sec:Calculation}

В предыдущей главе были приведены все необходимые теоретические сведения для дальнейшего численного решения краевых задач модели Томаса-Ферми с поправками. В этой главе будет показано, как реализован алгоритм расчёта.

В предыдущей главе был описан метод, которым были получены референсные значения укругости $K$, согласовавшиеся с ранее опубликованными значениями.

В разделе~\ref{Subsec:CalculationPrep} описана подготовка кристалла лизоцима из базы PDB к симуляции. Далее в \ref{Subsec:CalculationConverge} продемонстрирована сходимость количества добавляемой в белок воды по некоторым базовым параметрам. Наконец, в \ref{Subsec:Calculation2ways} описаны 2 используемых метода расчета модуля упругости по имеющимся МД траекториям.

\section{Подготовка PDB-белка к расчету}
\label{Subsec:CalculationPrep}

В качестве начальных данных используется модель белка лизоцима 1iee \citep{Sauter2001pdb, Sauter2001}. PDB-файл загружается из онлайн базы данных 
\href{https://www.rcsb.org/structure/1IEE}{rcsb.org/structure/1IEE}. Данная структура получана рентгеноструктурным анализом. Изначально в файле явно хранится лишь 1 из 8 цепочек белка. Также в файле есть информация о молекулах воды, зарегистрированных при рентгеноструктуромм анализе. И наконец, записаны операции симметрии, позволяющие имея структуру 1 цепочки восстановить положение всех 8-ми цепочек, составляющих одну периодическую ячейку кристалла.

При данной операции возникает проблема. Некоторые молекулы воды, размноженные и перенесенные по тем же операциям симметрии, что и атомы цепочки белка, начинают перекрываться с другими молекулами воды. Видимо это происходит потому, что сложно точно отнести молекулы воды, полученные на рентгене, к той или иной цепочке белка. Если же такого соотнесения воды с белковыми цепями нет, то ожидаемо, что часть молекул воды, явно хранимых в оригинальном файле, перекроются с другой водой, т.к. одна из молекул воды в такой перекрывшейся паре будет относиться не к той цепочки белка, которая хранится в файле явно. А поэтому такая воды не должна была участвовать в отражениях по симметрии в данной позиции. Для решения подобных перекрытий используется пакет UCSF Chimera \citep{Pettersen2004}. В нем расстояния между атомами кислорода сортируются. Четко выделяется группа контактов с расстоянием $< 0.01$ нм, т.к. более длинные контакны уже имеют длину $> 0.2$ нм. Выбираются все атомы, участвующие в таких наложившихся парах. Из них выбирается минимальный набор атомов, удаление которого решит все перекрытия, и стирается из файла. 

Далее происходит протонация белка. Оригинальные ренгеноструктурные данные не содержат протонов ${}^1$H, т.к. последние слабо влияют на электронную плотность, которая на самом деле и рассеивает ренген. А нечуствительность электронной плотности к нахождению протонов затрудняет вписывание известной последовательности белка в измеренную 3-мерную структуру плотности. Процесс протонации соответствует алгоритму PDB2PQR \citep{Dolinsky2004, Dolinsky2007}. Опишем его подробнее.

Первым этапом вычисляются $pKa$ аминокислотных остатнов белка. Это значения, такие, что когда $pH$ среды переходит $pKa$ данного остатка, то  меняется протонирование этого остатка. Строго говоря этот подход не совсем точен, т.к. бывает, что $pH$ среды близко к $pKa$ остатка. Тогда в реальности доля протонированных по разному остатков будет сравнима. Мы не можем воспроизвести данный эффект в расчете, т.к. в модели сильно ограничено количество оригинальных белков, а все периодические образы протонированы одинаково по построению. Покажем, что это не сильное отклонение модели от реальности. По определению

\begin{equation} \label{eq:2:prot_state_ratio}
pKa = \log_{10} \left( \dfrac{[AH] \cdot mol/L}{[A^-][H^+]} \right), \hspace{10pt} pH = -\log_{10} \left( \dfrac{[H^+]}{mol/L} \right) \Rightarrow \dfrac{[A^-]}{[HA]} = 10^{pH - pKa},
\end{equation}

где $[\ldots]$ -- концентрации соответствующих компонент в единицах моль/литр. Видно, что при отличии $pH$ среды от $pKa$ всего на 1 концентрации остатков с разной протонацией будут отличаться уже в 10 раз, что уже почти эквивалентно однородной протонации в нашей модели, т.к. учитываются $\sim 10$ оригинальных цепей белка.

Определение $pH$ также позволяет оценить, нужно ли пытаться включать в модель явные ионы диссоцировавшей воды

\begin{equation}
\begin{aligned}
& N_{H^+} = 10^{- pH} N_A \dfrac{V}{[L]} \sim 0.6 \cdot 10^{-pH} \dfrac{V}{[nm^3]},\\
& N_{OH^-} = 10^{pH - 14} N_A \dfrac{V}{[L]} \sim 0.6 \cdot 10^{pH - 14} \dfrac{V}{[nm^3]}
\end{aligned} ,
\end{equation}

где $V$ -- объем ячейки, $N_{H^+}$, $N_{OH^-}$ -- количества ионов соответствующего типа в данном объеме. В используемой ячейке $V\sim 400$ $nm^3$. В эксперименте $pH = 4.5$ \citep{Sauter2001}, что дает $N_{H^+} \sim 10^{-2} \ll 1$. Далее, $pH < 7$, поэтому $N_{OH^-} < N_{H^+} \ll 1$. А итоге можно сказать, что явный учет диссоциации воды в ячейке не возможен при данном размере расчетой области.

Вообще говоря, окружение аминокислотного остатка влияет на его $pKa$. Процесс расчета описан в \citep{Olsson2011}. Изложим его кратко. Значения $pKa$ в окружении полимерами складывается из основного $pKa^{water}$ для свободного остатка, и из поправки за счет окружения $\Delta pKa$. Референсные значения $pKa^{wat}$ известны с хорошей точностью \citep{Olsson2011}. Поправка складывается из нескольких вкладов.

\begin{equation}
\Delta pKa = \Delta pKa^{QQ} + \Delta pKa ^ {desolv} + \Delta pKa ^{HB} + \Delta pKa ^{RE}
\end{equation}

\begin{itemize}
\item $\Delta pKa^{QQ}_i$ -- сумма вкладов в $pKa_i$ от всех зарядов системы.
\item $\Delta pKa^{desolv}_i$ -- гидрофобные остатки эффективно отталкивают воду. Расталкивать чистую воду может быть сложнее или легче чем воду, окруженную белком, что и учитывает данное слагаемое.
\item $\Delta pKa ^{HB}$ -- вклад водородных связей в энергию
\item $\Delta pKa ^{RE}$ -- вклад прочих диполь-зарядных взаимодействий
\end{itemize} 

Вычислив $pKa$ всех остатков, можно на основе экспериментального $pH$ определить для остатков количество необходимых дополнительных протонов на основе \eqref{eq:2:prot_state_ratio}.

Для некоторых остатков, например HIS, ASN, TYR, существуют несколько состояний протонации с одинаковым зарядом. Для них нужно дополнительно проводить оптимизацию положения отдельных протонов и целых боковых цепей остатка.

Наконец, в процедуру протонации можно включить оптимизацию положения протонов в молекулах воды, что может уменьшить релаксационный период.

Имея протонированный белок, его нужно нейтрализовать добавлением ионов $Na^+$ и $Cl^-$. Так же, некоторое количество этих ионов отражены в рентгеноструктурных данных, и они тоже требуют нейтрализации. Недостающие ионы добавляются в вообще говоря случайные точки с тем условием, чтобы это было не слишком энергетически неоптимально. Это разумно, т.к. те ионы, которые устойчивы в системе, отражены на рентгеновских данных, а остальные ионы мобильны, поэтому не так важно где конкретно помещать их в начальный момент времени. 

Далее идет процесс сольвации системы. В нем в систему добавляется определенное количество воды. Вопрос какое именно обсуждается далее.

В силу большого количества случайных факторов, участвовавших в создании системы до данного момента, ее итоговое состояние может быть энергетически крайне невыгодно из-за перекрытия атомов или неадекватной взаимной геометрии боковых цепей остатков. Это решается путем симуляции в режиме минимизации энергии. В данном случае используется <<метод наискорейшего спуска>>. Формальное описание алгоритма:

\begin{enumerate}

\item Выбрать начальный размер шага, например $h_0 = 0.01$ нм.

\item 
\begin{equation} \label{eq:2:EM_scheme}
\mathbf{r}_{n+1} = \mathbf{r}_{n} + h_n \dfrac{\mathbf{F}_n}{max(|\mathbf{F}_n|)},
\end{equation}

где $r_n$ -- $3N$-мерный вектор координат всемх атомов, $F_n$ -- $3N$-мерный вектор всех сил на атомы.

\item Считаем новую энергию системы $V_{n+1}$

Если $V_{n+1} < V_n$, то $h_{n+1} = 1.2 h_n$.

Если $V_{n+1} > V_n$, то $h_{n+1} = 0.2 h_n$.

\item Повторяем пп. 2-3 пока не закончится заданное пользователем количество итераций, либо пока максимальная сила на атом не станет меньше заданного пользователем порога. Значение физичной пороговой силы можно оценить как $\omega \sqrt{m k_B T}$, где $\omega$ -- характерная частота в системе.

\end{enumerate}

По сути такая <<динамика>> эквивалентна движению атомов в абсолютно вязкой жидкости с ограничением максимальной скорости. В такой модели из-за вязкости $\sim v$ мгновенно устанавливается режим $v \sim F$, что превращает классическую схему эйлера решения уравнений движения в \eqref{eq:2:EM_scheme}.

Наконец после данного этапа система достаточно хорошо описывает реальность, чтобы при запуске динамики с физически-корректными законами движения она не развалилась. 

\section{Сходимость уровня гидротации}
\label{Subsec:CalculationConverge}

В предыдущем разделе \ref{Subsec:CalculationPrep} оставался один свободный параметр -- количество воды, добавляемое в систему при сольвации. Имея возможность симулировать систему, можно расчитывать в ней уже физические параметры, например давление. Нам известно, что в эксперименте давление было порядка атмосферного. Можно попробовать использовать эту информацию чтобы подобрать количество воды, приводящее к экспериментальному давлению. Для этого при каждой интересовавшей нас температуре были проведены несколько симуляций с разным количеством добавляемой воды. В каждой симуляции расчитывалось давление, и далее интерполяцией находилось количество воды, приводящее к целевому давлению. Идея представлена на 

\begin{figure}[h!]
  \center{\includegraphics[scale=0.4]{1atm_press_for_maxsol.jpg}}
  \caption{Пример определения количество воды, приводящего к экспериментальному (фактически нулевому) давлению для заданной температуре.}
  \label{img:2:1atm_press_for_maxsol}
\end{figure}


\section{2 метода расчета модуля упругости $K$ по траекториям}
\label{Subsec:Calculation2ways}

3
