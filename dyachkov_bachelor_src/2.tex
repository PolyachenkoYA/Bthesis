\chapter{Алгоритм расчёта термодинамических функций модели Томаса-Ферми и поправок к ней с заданной точностью}
\label{Sec:Calculation}

В предыдущей главе были приведены все необходимые теоретические сведения для дальнейшего численного решения краевых задач модели Томаса-Ферми с поправками. В этой главе будет показано, как реализован алгоритм расчёта.

В разделе~\ref{Subsec:CalculationMTF} будет описана реализация алгоритма расчёта самосогласованного потенциала в модели Томаса-Ферми. Далее в \ref{Subsec:CalculationMTFcorrect} будет показано, как вычисляются квантовые и обменные поправки к потенциалу и, наконец, в \ref{Subsec:CalculationThermodynamics} будет представлен метод вычисления термодинамических функций, а также их тепловых частей.

Подобный расчёт производился Н. Н. Калиткиным \cite{Kalitkin:1975}, но для данной работы требовалась большая точность вычислений для выделения тепловой части.

Все дифференциальные уравнения решались численно при помощи средств GNU Scientific Library \cite{GSL} для языка программирования C.

\section{Метод решения краевой задачи Томаса-Ферми}
\label{Subsec:CalculationMTF}

Вернёмся к краевой задаче для расчёта самосогласованного потенциала \eqref{eq:MTF_nonzero}. Будем искать потенциал методом стрельбы, решая задачу Коши с начальными данными в точке $ x = 1 $. Реализация метода стрельбы состоит в следующем: некоторый отрезок с пробными значениями потенциала $ \phi $ на правом конце выбирается таким образом, чтобы вычисленные в нуле значения лежали по разную сторону от заданного $ \phi(0) $.

Обозначив $ a=4\sqrt{2T}r^2_0/\pi $, перепишем систему в виде:
\begin{equation}
  \label{eq:MTF_cauchy}
  \left\{
    \begin{aligned}
      \phi'(x) &= \xi(x), \\
      \xi'(x) &= axI_{1/2}\left(\frac{\phi}{x}\right), \\
      \phi(1) &= \xi(1) = \phi^{test}_{1,2}(1).
    \end{aligned}
  \right.
\end{equation}
Так, методом деления отрезка $ [\phi^{test}_1(1), \phi^{test}_2(1)] $ пополам, будем подбирать начальные данные до тех пор, пока не добьёмся нужной точности $ |\phi^{test}_{1,2}(0) - \phi(0)| < \varepsilon $.

\section{Метод решения краевой задачи для поправок к потенциалу}
\label{Subsec:CalculationMTFcorrect}

Рассмотрим теперь краевую задачу для поправки к потенциалу \eqref{eq:MTF_correction}.
В отличие от предыдущей, здесь возникают две трудности.

Первая трудность заключается в том, что в уравнение для поправки входит сам потенциал $ \phi(x) $. Чтобы добиться нужной точности, будем решать краевую задачу для поправки совместно с задачей для самого потенциала. Поэтому, проделав процедуру, описанную в \ref{Subsec:CalculationMTF}, приступаем к решению следующей задачи:
\begin{equation}
  \label{TFmodel_corrections_Koshi}
  \left\{
    \begin{aligned}
      \phi'(x) &= \xi(x), \\
      \xi'(x) &= axI_{1/2}\left(\frac{\phi(x)}{x}\right),\\
      \chi'(x) &=\psi(x), \\
      \psi'(x) &=a
        \left[
          I_{1/2}'\left(\frac{\phi(x)}{x}\right) +
          xY_{1/2}'\left(\frac{\phi(x)}{x}\right)
        \right],\\
    \phi(1) &= \xi(1) = \phi_1, \\
    \chi(1) &= \psi(1) = \chi^{test}_{1,2}(1),
   \end{aligned}
   \right.
\end{equation}
где значения $ \chi^{test}_{1,2}(1) $ также подбираются методом деления
отрезка $ [\chi^{test}_{1}(1) $, $ \chi^{test}_{2}(1)] $ пополам.

Вторая трудность связана с вычислением следующей производной:
$$
  Y'(x) = \frac{7}{4}I^2_{-1/2}(x) + \frac12 I_{1/2}(x)I'_{-1/2}(x).
$$
В GNU Scientific Library имеются достаточно точные варианты функций Фер- ми-Дирака. Но для вычисления производной $ I'_{-1/2}(x) $ нельзя воспользоваться рекуррентным соотношением $ I'_k(x) = kI_{k-1}(x) $, так как соответствующий интеграл расходится. Вычислить эту производную помогло дифференцирование очень точной аппроксимации функции $ I_{-1/2}(x) $ \cite{Antia:AJSS:1993}.

Итак, научившись находить потенциал и поправку к нему, можно перейти к вычислению термодинамических функций.

\section{Вычисление термодинамических функций и их тепловых частей}
\label{Subsec:CalculationThermodynamics}

Определив описанным в \ref{Subsec:CalculationMTF} методом $ \phi(1) $, можно сразу вычислить давление по формуле \eqref{eq:pressure}. С энергией дело обстоит сложнее, так как в этом случае нужно вычислять интеграл от функции, содержащей потенциал, значения которого определяются только решением системы \eqref{eq:MTF_nonzero}. Поступим следующим образом: в формуле для энергии \eqref{eq:energy} сделаем верхний предел интегрирования $ x = 1 $ переменным:

$$
  E(x) =
  \frac{\sqrt2}{\pi^2}\upsilon T^{5/2}
  \left[
    2 I_{3/2}(\phi(x))
    -
    3 \int_0^xI_{3/2}
      \left(
        \frac{\phi(t)}{t}
      \right)
    t^2 dt
  \right] - E_0
$$
и продифференцируем по $ x $:
\begin{equation}
  E'(x) = \frac{3\sqrt2}{\pi^2}\upsilon T^{5/2}
  \left[
    I_{1/2}(\phi(x))\phi'(x)
    -
    I_{3/2}
    \left(
      \frac{\phi(x)}{x}
    \right) x^2
  \right].
  \label{eq:dE/dx}
\end{equation}
Теперь будем решать следующую задачу Коши:
\begin{equation}
  \label{MTF_Koshi_with_energy}
  \left\{
   \begin{aligned}
      \phi'(x) &= \xi(x),
      \\
      \xi'(x) &= axI_{1/2}
      \left(
        \frac{\phi}{x}
      \right),
      \\
      E'(x) &= \frac{3\sqrt2}{\pi^2}\upsilon T^{5/2}
      \left[
        I_{1/2}(\phi(x))\xi(x)
        -
        I_{3/2}
        \left(
          \frac{\phi(x)}{x}
        \right)
        x^2
      \right], \\
    \phi(0) &= \phi_0, \quad \xi(0) = \xi_0
    \text{ - определяется при вычислении $ \phi(0) $ в задаче \eqref{eq:MTF_cauchy}} \\
    E(0) &= \frac{2\sqrt2}{\pi^2}\upsilon T^{5/2} I_{3/2}(\phi(0)) - E_0
   \end{aligned}
   \right.
\end{equation}
и в точке $ x = 1 $ получим нужное значение энергии $ E \equiv E(1) $. При этом все уравнения будут интегрироваться совместно и с заданной точностью.

Аналогично можно поступить и при вычислении поправок. Определив $ \chi(1) $, мы сразу вычисляем поправку к давлению по формуле \eqref{eq:pressure_correction}. В выражении для поправки к энергии делаем правый конец переменным:
\begin{multline}
  \Delta E(x) =
  \frac{2T^2}{3\pi^2}r_0^2
  \left[
     \int_0^x
     t\chi(t)I_{1/2}
     \left(
       \frac{\phi(t)}{t}
     \right)dt
  \right.
   + \\ +
  \left.
    \int_0^x
      2t^2Y
      \left(
        \frac{\phi(t)}{t}
      \right)dt
  \right]
   + \frac{\sqrt{2T}}{6\pi}\chi'(0)
   - \Delta E_0
\end{multline}
дифференцируем по $ x $
$$
  \Delta E'(x) =
  \frac{2T^2}{3\pi^2}r_0^2
  \left[
     x\chi(x)I_{1/2}
     \left(
       \frac{\phi(x)}{x}
     \right)
   +
      2x^2Y
      \left(
        \frac{\phi(x)}{x}
      \right)
  \right]
$$
и решаем задачу Коши:
\begin{equation}
  \label{MTF_Koshi_with_energy_correction}
  \left\{
   \begin{aligned}
      \phi'(x) &= \xi(x), \\
      \xi'(x) &= axI_{1/2}\left(\frac{\phi(x)}{x}\right),\\
      \chi'(x) &=\psi(x), \\
      \psi'(x) &=a
        \left[
          I_{1/2}'\left(\frac{\phi(x)}{x}\right) +
          xY_{1/2}'\left(\frac{\phi(x)}{x}\right)
        \right],\\
      \Delta E'(x) &=
      \frac{2T^2}{3\pi^2}r_0^2
      \left[
      x\chi(x)I_{1/2}
      \left(
        \frac{\phi(x)}{x}
      \right)
      +
      2x^2Y
      \left(
        \frac{\phi(x)}{x}
      \right)
      \right],
      \\
      \phi(0) &= \phi_0, \quad \xi(0) = \xi_0, \\
      \chi(0) &= 0, \quad \psi(0) = \psi_0, \\
      \Delta E(0) &= \frac{\sqrt{2T}}{6\pi}\chi'(0) - \Delta E_0,
   \end{aligned}
   \right.
\end{equation}
определив, тем самым, $ \Delta E(1) \equiv \Delta E $.

Вычисленные таким способом значения энергии и давления при очень низких температурах в пределах заданной точности соответствуют решению уравнения Томаса-Ферми при нулевой температуре. Поэтому при вычислении тепловой части будем пользоваться результатами уже описанной процедуры для достаточно низких температур.
